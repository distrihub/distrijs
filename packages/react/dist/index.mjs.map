{"version":3,"sources":["../src/DistriProvider.tsx","../src/useAgent.ts","../src/useAgents.ts","../src/useChat.ts","../src/useThreads.ts","../src/useTools.ts","../src/components/EmbeddableChat.tsx","../src/components/MessageComponents.tsx","../src/components/MessageRenderer.tsx","../src/components/ChatContext.tsx","../src/utils/messageUtils.ts","../src/components/FullChat.tsx","../src/components/ChatContainer.tsx","../src/components/ApprovalDialog.tsx","../src/components/Toast.tsx","../src/components/Chat.tsx","../src/components/ExternalToolManager.tsx","../src/builtinHandlers.ts"],"sourcesContent":["import { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport { DistriClient, DistriClientConfig } from '@distri/core';\n\ninterface DistriContextValue {\n  client: DistriClient | null;\n  error: Error | null;\n  isLoading: boolean;\n}\n\nconst DistriContext = createContext<DistriContextValue>({\n  client: null,\n  error: null,\n  isLoading: true\n});\n\ninterface DistriProviderProps {\n  config: DistriClientConfig;\n  children: ReactNode;\n}\n\nconst debug = (config: DistriClientConfig, ...args: any[]): void => {\n  if (config.debug) {\n    console.log('[DistriProvider]', ...args);\n  }\n}\n\n\nexport function DistriProvider({ config, children }: DistriProviderProps) {\n  const [client, setClient] = useState<DistriClient | null>(null);\n  const [error, setError] = useState<Error | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    let currentClient: DistriClient | null = null;\n\n    try {\n      debug(config, '[DistriProvider] Initializing client with config:', config);\n      currentClient = new DistriClient(config);\n      setClient(currentClient);\n      setError(null);\n      setIsLoading(false);\n      debug(config, '[DistriProvider] Client initialized successfully');\n    } catch (err) {\n      debug(config, '[DistriProvider] Failed to initialize client:', err);\n      const error = err instanceof Error ? err : new Error('Failed to initialize client');\n      setError(error);\n      setClient(null);\n      setIsLoading(false);\n    }\n\n  }, [config]); // Depend on the entire config object since we memoize it now\n\n  const contextValue: DistriContextValue = {\n    client,\n    error,\n    isLoading\n  };\n\n  if (error) {\n    console.error(config, '[DistriProvider] Rendering error state:', error.message);\n  }\n\n  if (isLoading) {\n    debug(config, '[DistriProvider] Rendering loading state');\n  }\n\n  if (client) {\n    debug(config, '[DistriProvider] Rendering with client available');\n  }\n\n  return (\n    <DistriContext.Provider value={contextValue}>\n      {children}\n    </DistriContext.Provider>\n  );\n}\n\nexport function useDistri(): DistriContextValue {\n  const context = useContext(DistriContext);\n  if (!context) {\n    throw new Error('useDistri must be used within a DistriProvider');\n  }\n  return context;\n}\n\nexport function useDistriClient(): DistriClient {\n  const { client, error, isLoading } = useDistri();\n\n  if (isLoading) {\n    throw new Error('Distri client is still loading');\n  }\n\n  if (error) {\n    throw new Error(`Distri client initialization failed: ${error.message}`);\n  }\n\n  if (!client) {\n    throw new Error('Distri client is not initialized');\n  }\n\n  return client;\n}","import React, { useState, useCallback, useRef } from 'react';\nimport {\n  Agent,\n} from '@distri/core';\nimport { useDistri } from './DistriProvider';\n\nexport interface UseAgentOptions {\n  agentId: string;\n  autoCreateAgent?: boolean;\n}\n\nexport interface UseAgentResult {\n  // Agent information\n  agent: Agent | null;\n\n  // State management\n  loading: boolean;\n  error: Error | null;\n}\n\n/**\n * useAgent is for agent configuration and invocation.\n * For chat UIs, use useChat instead.\n */\nexport function useAgent({\n  agentId,\n  autoCreateAgent = true,\n}: UseAgentOptions): UseAgentResult {\n  const { client, error: clientError, isLoading: clientLoading } = useDistri();\n  const [agent, setAgent] = useState<Agent | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const agentRef = useRef<Agent | null>(null);\n\n  // Initialize agent\n  const initializeAgent = useCallback(async () => {\n    if (!client || !agentId || agentRef.current) return;\n\n    try {\n      setLoading(true);\n      setError(null);\n      const newAgent = await Agent.create(agentId, client);\n      agentRef.current = newAgent;\n      setAgent(newAgent);\n    } catch (err) {\n      setError(err instanceof Error ? err : new Error('Failed to create agent'));\n    } finally {\n      setLoading(false);\n    }\n  }, [client, agentId]);\n\n  // Auto-initialize agent when client is ready\n  React.useEffect(() => {\n    if (!clientLoading && !clientError && autoCreateAgent && client) {\n      initializeAgent();\n    }\n  }, [clientLoading, clientError, autoCreateAgent, client, initializeAgent]);\n\n\n  return {\n    // Agent information\n    agent,\n\n    // State management\n    loading: loading || clientLoading,\n    error: error || clientError,\n  };\n}\n\n","import { useState, useEffect, useCallback } from 'react';\nimport { DistriAgent } from '@distri/core';\nimport { useDistri } from './DistriProvider';\n\nexport interface UseAgentsResult {\n  agents: DistriAgent[];\n  loading: boolean;\n  error: Error | null;\n  refetch: () => Promise<void>;\n  getAgent: (agentId: string) => Promise<DistriAgent>;\n}\n\nexport function useAgents(): UseAgentsResult {\n  const { client, error: clientError, isLoading: clientLoading } = useDistri();\n  const [agents, setAgents] = useState<DistriAgent[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const fetchAgents = useCallback(async () => {\n    if (!client) {\n      console.log('[useAgents] Client not available, skipping fetch');\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError(null);\n      console.log('[useAgents] Fetching agents...');\n      const fetchedAgents = await client.getAgents();\n      console.log('[useAgents] Fetched agents:', fetchedAgents);\n      setAgents(fetchedAgents);\n    } catch (err) {\n      console.error('[useAgents] Failed to fetch agents:', err);\n      setError(err instanceof Error ? err : new Error('Failed to fetch agents'));\n    } finally {\n      setLoading(false);\n    }\n  }, [client]);\n\n  const getAgent = useCallback(async (agentId: string): Promise<DistriAgent> => {\n    if (!client) {\n      throw new Error('Client not available');\n    }\n\n    try {\n      const agent = await client.getAgent(agentId);\n      \n      // Update the agent in our local state if it exists\n      setAgents(prev => prev.map(a => a.id === agentId ? agent : a));\n      \n      return agent;\n    } catch (err) {\n      const error = err instanceof Error ? err : new Error('Failed to get agent');\n      setError(error);\n      throw error;\n    }\n  }, [client]);\n\n  useEffect(() => {\n    if (clientLoading) {\n      console.log('[useAgents] Client is loading, waiting...');\n      setLoading(true);\n      return;\n    }\n\n    if (clientError) {\n      console.error('[useAgents] Client error:', clientError);\n      setError(clientError);\n      setLoading(false);\n      return;\n    }\n\n    if (client) {\n      console.log('[useAgents] Client ready, fetching agents');\n      fetchAgents();\n    } else {\n      console.log('[useAgents] No client available');\n      setLoading(false);\n    }\n  }, [clientLoading, clientError, client, fetchAgents]);\n\n  return {\n    agents,\n    loading: loading || clientLoading,\n    error: error || clientError,\n    refetch: fetchAgents,\n    getAgent\n  };\n}","import { useState, useEffect, useCallback, useRef, useMemo } from 'react';\nimport { useAgent } from './useAgent';\nimport {\n  type Message,\n  type MessageMetadata,\n  type ToolResult,\n  type ToolCall,\n  InvokeConfig,\n  DistriClient,\n  Agent,\n} from '@distri/core';\nimport type { Part } from '@a2a-js/sdk/client';\n\nexport interface UseChatOptions {\n  agentId: string;\n  threadId: string;\n  // Optional: pre-configured agent from useAgent\n  agent?: Agent;\n  // Optional: Metadata to pass to the agent\n  metadata?: any;\n}\n\nexport interface UseChatResult {\n  messages: Message[];\n  loading: boolean;\n  error: Error | null;\n  isStreaming: boolean;\n  sendMessage: (input: string | Part[], metadata?: MessageMetadata) => Promise<void>;\n  sendMessageStream: (input: string | Part[], metadata?: MessageMetadata) => Promise<void>;\n  refreshMessages: () => Promise<void>;\n  clearMessages: () => void;\n  agent: Agent | null;\n}\n\n/**\n * useChat is the main hook for chat UIs with simplified tool handling.\n * Tools are now registered directly on the agent using agent.addTool() or useTools hook.\n */\nexport function useChat({\n  agentId,\n  threadId,\n  agent: providedAgent,\n  metadata,\n}: UseChatOptions): UseChatResult {\n  // Use provided agent or create one internally\n  const { agent: internalAgent } = useAgent({\n    agentId,\n  });\n\n  // Use provided agent if it's a proper Agent instance, otherwise use internal agent\n  const agent = (providedAgent && typeof providedAgent.getThreadMessages === 'function') ? providedAgent : internalAgent;\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const [isStreaming, setIsStreaming] = useState(false);\n  const abortControllerRef = useRef<AbortController | null>(null);\n\n  // Clear messages when threadId changes\n  useEffect(() => {\n    setMessages([]);\n    setError(null);\n  }, [threadId]);\n\n  const invokeConfig = useMemo(() => {\n    return {\n      contextId: threadId,\n      configuration: {\n        acceptedOutputModes: ['text/plain'],\n        blocking: false\n      },\n      metadata: metadata\n    } as InvokeConfig;\n  }, [threadId, metadata]);\n\n  // Fetch messages for the thread\n  const fetchMessages = useCallback(async () => {\n    if (!agent || !threadId) {\n      setMessages([]);\n      return;\n    }\n    try {\n      setLoading(true);\n      setError(null);\n      const fetchedMessages = await agent.getThreadMessages(threadId);\n      setMessages(fetchedMessages);\n    } catch (err) {\n      setError(err instanceof Error ? err : new Error('Failed to fetch messages'));\n      setMessages([]);\n    } finally {\n      setLoading(false);\n    }\n  }, [agent, threadId]);\n\n  useEffect(() => {\n    fetchMessages();\n  }, [fetchMessages]);\n\n  // Handle tool calls from assistant messages\n  const handleToolCalls = useCallback(async (toolCalls: ToolCall[]): Promise<void> => {\n    if (!agent) return;\n\n    const results: ToolResult[] = [];\n\n    // Execute all tool calls\n    for (const toolCall of toolCalls) {\n      const result = await agent.executeTool(toolCall);\n      results.push(result);\n    }\n\n    // Send tool responses back to the agent\n    if (results.length > 0) {\n      const responseMessage = DistriClient.initMessage([], 'user', { \n        contextId: threadId, \n        metadata: {\n          type: 'tool_responses',\n          results: results\n        } as MessageMetadata\n      });\n\n      const params = DistriClient.initMessageParams(\n        responseMessage, \n        invokeConfig.configuration, \n        responseMessage.metadata as MessageMetadata\n      );\n\n      // Continue the conversation with tool results\n      try {\n        const stream = await agent.invokeStream(params);\n        \n        for await (const event of stream) {\n          if (abortControllerRef.current?.signal.aborted) break;\n          await handleStreamEvent(event);\n        }\n      } catch (err) {\n        console.error('Error continuing conversation with tool results:', err);\n      }\n    }\n  }, [agent, threadId, invokeConfig.configuration]);\n\n  // Handle individual stream events\n  const handleStreamEvent = useCallback(async (event: any) => {\n    if (event.kind === 'message') {\n      const message = event as Message;\n      \n      setMessages((prev) => {\n        const idx = prev.findIndex((m) => m.messageId === message.messageId);\n        if (idx !== -1) {\n          const updated = [...prev];\n          updated[idx] = { ...updated[idx], parts: [...updated[idx].parts, ...message.parts] };\n          return updated;\n        } else {\n          return [...prev, message];\n        }\n      });\n\n      // Handle tool calls if present\n      if (message.metadata?.type === 'assistant_response' && message.metadata.tool_calls) {\n        const toolCalls = message.metadata.tool_calls as ToolCall[];\n        await handleToolCalls(toolCalls);\n      }\n    } else if (event.kind === 'status-update') {\n      // Handle task status updates if needed\n      // These events can be used for progress indicators, etc.\n      console.debug('Task status update:', event);\n    }\n  }, [handleToolCalls]);\n\n  // Send a message (non-streaming)\n  const sendMessage = useCallback(async (\n    input: string | Part[],\n    metadata?: MessageMetadata\n  ) => {\n    if (!agent) return;\n\n    // Add user message immediately\n    const userMessage: Message = DistriClient.initMessage(input, 'user', { contextId: threadId, metadata });\n    setMessages((prev) => [...prev, userMessage]);\n\n    const params = DistriClient.initMessageParams(userMessage, invokeConfig.configuration, metadata);\n    try {\n      setLoading(true);\n      setError(null);\n      const result = await agent.invoke(params);\n      if (result && 'message' in result && result.message) {\n        setMessages((prev) => [...prev, result.message as Message]);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err : new Error('Failed to send message'));\n    } finally {\n      setLoading(false);\n    }\n  }, [agent, threadId, invokeConfig.configuration]);\n\n  // Send a message (streaming)\n  const sendMessageStream = useCallback(async (\n    input: string | Part[],\n    metadata?: MessageMetadata\n  ) => {\n    if (!agent) return;\n\n    const userMessage: Message = DistriClient.initMessage(input, 'user', { contextId: threadId, metadata });\n    setMessages((prev) => [...prev, userMessage]);\n\n    const params = DistriClient.initMessageParams(userMessage, invokeConfig.configuration, metadata);\n\n    try {\n      setLoading(true);\n      setIsStreaming(true);\n      setError(null);\n      \n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n      abortControllerRef.current = new AbortController();\n\n      const stream = await agent.invokeStream(params);\n\n      for await (const event of stream) {\n        if (abortControllerRef.current?.signal.aborted) break;\n        await handleStreamEvent(event);\n      }\n    } catch (err) {\n      if (err instanceof Error && err.name === 'AbortError') return;\n      setError(err instanceof Error ? err : new Error('Failed to stream message'));\n    } finally {\n      setLoading(false);\n      setIsStreaming(false);\n    }\n  }, [agent, threadId, invokeConfig.configuration, handleStreamEvent]);\n\n  const clearMessages = useCallback(() => {\n    setMessages([]);\n  }, []);\n\n  const refreshMessages = useCallback(async () => {\n    await fetchMessages();\n  }, [fetchMessages]);\n\n  return {\n    messages,\n    loading,\n    error,\n    isStreaming,\n    sendMessage,\n    sendMessageStream,\n    refreshMessages,\n    clearMessages,\n    agent: agent ? (agent as any) : null,\n  };\n} ","import { useState, useEffect, useCallback } from 'react';\nimport { DistriThread } from '@distri/core';\nimport { useDistri } from './DistriProvider';\n\nexport interface UseThreadsResult {\n  threads: DistriThread[];\n  loading: boolean;\n  error: Error | null;\n  refetch: () => Promise<void>;\n  deleteThread: (threadId: string) => Promise<void>;\n  fetchThread: (threadId: string) => Promise<DistriThread>;\n  updateThread: (threadId: string, localId?: string) => Promise<void>;\n}\n\nexport function useThreads(): UseThreadsResult {\n  const { client, error: clientError, isLoading: clientLoading } = useDistri();\n  const [threads, setThreads] = useState<DistriThread[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const fetchThreads = useCallback(async () => {\n    if (!client) {\n      console.log('[useThreads] Client not available, skipping fetch');\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError(null);\n      console.log('[useThreads] Fetching threads...');\n      const fetchedThreads = await client.getThreads();\n      console.log('[useThreads] Fetched threads:', fetchedThreads);\n      setThreads(fetchedThreads);\n    } catch (err) {\n      console.error('[useThreads] Failed to fetch threads:', err);\n      setError(err instanceof Error ? err : new Error('Failed to fetch threads'));\n    } finally {\n      setLoading(false);\n    }\n  }, [client]);\n\n  const fetchThread = useCallback(async (threadId: string) => {\n    if (!client) {\n      throw new Error('Client not available');\n    }\n    try {\n      const response = await client.getThread(threadId);\n      return response;\n    } catch (err) {\n      console.error('[useThreads] Failed to fetch thread:', err);\n      throw err;\n    }\n  }, [client]);\n\n  const deleteThread = useCallback(async (threadId: string) => {\n    if (!client) {\n      throw new Error('Client not available');\n    }\n\n    try {\n      // Try to delete from server (may not exist yet for local threads)\n      const response = await fetch(`${client.baseUrl}/api/v1/threads/${threadId}`, {\n        method: 'DELETE',\n      });\n      if (!response.ok) {\n        throw new Error('Failed to delete thread');\n      }\n\n      // Remove from local state regardless of server response\n      setThreads(prev => prev.filter(thread => thread.id !== threadId));\n    } catch (err) {\n      // Still remove from local state even if server delete fails\n      setThreads(prev => prev.filter(thread => thread.id !== threadId));\n      console.warn('Failed to delete thread from server, but removed locally:', err);\n    }\n  }, [client]);\n\n  const updateThread = useCallback(async (threadId: string, localId?: string) => {\n    if (!client) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`${client.baseUrl}/api/v1/threads/${threadId}`);\n      if (response.ok) {\n        const updatedThread = await response.json();\n        setThreads(prev => {\n          // If a local thread with localId exists, replace it with the backend thread\n          if (localId && prev.some(thread => thread.id === localId)) {\n            return [\n              updatedThread,\n              ...prev.filter(thread => thread.id !== localId && thread.id !== threadId)\n            ];\n          }\n          // Otherwise, just update by threadId\n          return prev.map(thread =>\n            thread.id === threadId ? updatedThread : thread\n          );\n        });\n      }\n    } catch (err) {\n      console.warn('Failed to update thread:', err);\n    }\n  }, [client]);\n\n  useEffect(() => {\n    if (clientLoading) {\n      console.log('[useThreads] Client is loading, waiting...');\n      setLoading(true);\n      return;\n    }\n\n    if (clientError) {\n      console.error('[useThreads] Client error:', clientError);\n      setError(clientError);\n      setLoading(false);\n      return;\n    }\n\n    if (client) {\n      console.log('[useThreads] Client ready, fetching threads');\n      fetchThreads();\n    } else {\n      console.log('[useThreads] No client available');\n      setLoading(false);\n    }\n  }, [clientLoading, clientError, client, fetchThreads]);\n\n  return {\n    threads,\n    loading: loading || clientLoading,\n    error: error || clientError,\n    refetch: fetchThreads,\n    deleteThread,\n    fetchThread,\n    updateThread\n  };\n}\n\nexport interface UseThreadMessagesOptions {\n  threadId: string | null;\n}","import { useCallback, useRef } from 'react';\nimport { DistriTool, ToolCall, ToolResult, Agent } from '@distri/core';\n\nexport interface UseToolsOptions {\n  agent?: Agent | null;\n}\n\nexport interface UseToolsResult {\n  addTool: (tool: DistriTool) => void;\n  addTools: (tools: DistriTool[]) => void;\n  removeTool: (toolName: string) => void;\n  executeTool: (toolCall: ToolCall) => Promise<ToolResult>;\n  getTools: () => string[];\n  hasTool: (toolName: string) => boolean;\n}\n\n/**\n * Hook for managing tools in an agent\n * Follows AG-UI pattern for tool registration\n */\nexport function useTools({ agent }: UseToolsOptions): UseToolsResult {\n  // Keep track of tools added through this hook\n  const toolsRef = useRef<Set<string>>(new Set());\n\n  const addTool = useCallback((tool: DistriTool) => {\n    if (!agent) {\n      console.warn('Cannot add tool: no agent provided');\n      return;\n    }\n    \n    agent.addTool(tool);\n    toolsRef.current.add(tool.name);\n  }, [agent]);\n\n  const addTools = useCallback((tools: DistriTool[]) => {\n    if (!agent) {\n      console.warn('Cannot add tools: no agent provided');\n      return;\n    }\n    \n    tools.forEach(tool => {\n      agent.addTool(tool);\n      toolsRef.current.add(tool.name);\n    });\n  }, [agent]);\n\n  const removeTool = useCallback((toolName: string) => {\n    if (!agent) {\n      console.warn('Cannot remove tool: no agent provided');\n      return;\n    }\n    \n    agent.removeTool(toolName);\n    toolsRef.current.delete(toolName);\n  }, [agent]);\n\n  const executeTool = useCallback(async (toolCall: ToolCall): Promise<ToolResult> => {\n    if (!agent) {\n      return {\n        tool_call_id: toolCall.tool_call_id,\n        result: null,\n        success: false,\n        error: 'No agent provided'\n      };\n    }\n    \n    return agent.executeTool(toolCall);\n  }, [agent]);\n\n  const getTools = useCallback((): string[] => {\n    if (!agent) return [];\n    return agent.getTools();\n  }, [agent]);\n\n  const hasTool = useCallback((toolName: string): boolean => {\n    if (!agent) return false;\n    return agent.hasTool(toolName);\n  }, [agent]);\n\n  return {\n    addTool,\n    addTools,\n    removeTool,\n    executeTool,\n    getTools,\n    hasTool\n  };\n}\n\n/**\n * Utility function to create common tool definitions\n */\nexport const createTool = (\n  name: string,\n  description: string,\n  parameters: any,\n  handler: (input: any) => Promise<any> | any\n): DistriTool => ({\n  name,\n  description,\n  parameters,\n  handler\n});\n\n/**\n * Built-in tool definitions\n */\nexport const createBuiltinTools = () => ({\n  /**\n   * Confirmation tool for user approval\n   */\n  confirm: createTool(\n    'confirm',\n    'Ask user for confirmation',\n    {\n      type: 'object',\n      properties: {\n        message: { type: 'string', description: 'Message to show to user' },\n        defaultValue: { type: 'boolean', description: 'Default value if user doesnt respond' }\n      },\n      required: ['message']\n    },\n    async (input: { message: string; defaultValue?: boolean }) => {\n      const result = confirm(input.message);\n      return { confirmed: result };\n    }\n  ),\n\n  /**\n   * Input request tool\n   */\n  input: createTool(\n    'input',\n    'Request text input from user',\n    {\n      type: 'object',\n      properties: {\n        prompt: { type: 'string', description: 'Prompt to show to user' },\n        placeholder: { type: 'string', description: 'Placeholder text' }\n      },\n      required: ['prompt']\n    },\n    async (input: { prompt: string; placeholder?: string }) => {\n      const result = prompt(input.prompt, input.placeholder);\n      return { input: result };\n    }\n  ),\n\n  /**\n   * Notification tool\n   */\n  notify: createTool(\n    'notify',\n    'Show notification to user',\n    {\n      type: 'object',\n      properties: {\n        message: { type: 'string', description: 'Notification message' },\n        type: { type: 'string', enum: ['info', 'success', 'warning', 'error'], description: 'Notification type' }\n      },\n      required: ['message']\n    },\n    async (input: { message: string; type?: string }) => {\n      // In a real app, this would show a toast notification\n      console.log(`[${input.type || 'info'}] ${input.message}`);\n      return { notified: true };\n    }\n  )\n});","import React, { useState, useRef, useEffect, useCallback, useMemo } from 'react';\nimport { Send, Loader2 } from 'lucide-react';\nimport { Agent } from '@distri/core';\nimport { useChat } from '../useChat';\nimport { UserMessage, AssistantMessage, AssistantWithToolCalls, PlanMessage } from './MessageComponents';\nimport { shouldDisplayMessage, extractTextFromMessage, getMessageType } from '../utils/messageUtils';\nimport '../styles/themes.css';\n\nexport interface EmbeddableChatProps {\n  agentId: string;\n  threadId?: string;\n  agent?: Agent;\n  metadata?: any;\n  height?: string | number;\n  placeholder?: string;\n  className?: string;\n  // Customization props\n  UserMessageComponent?: React.ComponentType<any>;\n  AssistantMessageComponent?: React.ComponentType<any>;\n  AssistantWithToolCallsComponent?: React.ComponentType<any>;\n  PlanMessageComponent?: React.ComponentType<any>;\n  // Theme\n  theme?: 'light' | 'dark' | 'auto';\n  // Show debug info\n  showDebug?: boolean;\n  // Callbacks\n  onMessageSent?: (message: string) => void;\n  onResponse?: (response: any) => void;\n}\n\nexport const EmbeddableChat: React.FC<EmbeddableChatProps> = ({\n  agentId,\n  threadId = 'default',\n  agent,\n  metadata,\n  height = 500,\n  placeholder = \"Type your message...\",\n  className = '',\n  UserMessageComponent = UserMessage,\n  AssistantMessageComponent = AssistantMessage,\n  AssistantWithToolCallsComponent = AssistantWithToolCalls,\n  PlanMessageComponent = PlanMessage,\n  theme = 'dark',\n  showDebug = false,\n  onMessageSent,\n  onResponse: _onResponse, // Currently unused but reserved for future response handling\n}) => {\n  const [input, setInput] = useState('');\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n\n  const {\n    messages,\n    loading,\n    error,\n    isStreaming,\n    sendMessageStream,\n  } = useChat({\n    agentId,\n    threadId,\n    agent,\n    metadata,\n  });\n\n  // Auto-scroll to bottom when new messages arrive\n  const scrollToBottom = useCallback(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, []);\n\n  useEffect(() => {\n    if (messages.length > 0) {\n      scrollToBottom();\n    }\n  }, [messages, scrollToBottom]);\n\n  const sendMessage = useCallback(async () => {\n    if (!input.trim() || loading || isStreaming) return;\n\n    const messageText = input.trim();\n    setInput('');\n    \n    onMessageSent?.(messageText);\n\n    try {\n      await sendMessageStream(messageText);\n    } catch (error) {\n      console.error('Failed to send message:', error);\n      setInput(messageText); // Restore input on error\n    }\n  }, [input, loading, isStreaming, sendMessageStream, onMessageSent]);\n\n  const handleKeyPress = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  }, [sendMessage]);\n\n  // Filter and render messages\n  const renderedMessages = useMemo(() => {\n    return messages\n      .filter(message => shouldDisplayMessage(message, showDebug))\n      .map((message: any, index: number) => {\n        const timestamp = new Date(message.timestamp || Date.now());\n        const messageText = extractTextFromMessage(message);\n        const messageType = getMessageType(message);\n        const key = message.messageId || `${messageType}-${index}`;\n\n        switch (messageType) {\n          case 'user':\n            return (\n              <UserMessageComponent\n                key={key}\n                content={messageText}\n                timestamp={timestamp}\n              />\n            );\n\n          case 'assistant_with_tools':\n            const toolCallsProps = message.metadata.tool_calls?.map((toolCall: any) => ({\n              toolCall,\n              status: 'completed',\n              result: 'Tool executed successfully',\n              error: null,\n            })) || [];\n\n            return (\n              <AssistantWithToolCallsComponent\n                key={key}\n                content={messageText}\n                toolCalls={toolCallsProps}\n                timestamp={timestamp}\n                isStreaming={isStreaming && index === messages.length - 1}\n                metadata={message.metadata}\n              />\n            );\n\n          case 'plan':\n            return (\n              <PlanMessageComponent\n                key={key}\n                content={messageText || message.metadata?.plan || 'Planning...'}\n                duration={message.metadata?.duration}\n                timestamp={timestamp}\n              />\n            );\n\n          case 'assistant':\n          default:\n            return (\n              <AssistantMessageComponent\n                key={key}\n                content={messageText || 'Empty message'}\n                timestamp={timestamp}\n                isStreaming={isStreaming && index === messages.length - 1}\n                metadata={message.metadata}\n              />\n            );\n        }\n      });\n  }, [\n    messages,\n    showDebug,\n    isStreaming,\n    UserMessageComponent,\n    AssistantMessageComponent,\n    AssistantWithToolCallsComponent,\n    PlanMessageComponent,\n  ]);\n\n  // Apply theme class\n  const themeClass = theme === 'auto' ? '' : theme;\n  const containerHeight = typeof height === 'number' ? `${height}px` : height;\n\n  return (\n    <div \n      className={`distri-chat ${themeClass} ${className}`}\n      style={{ height: containerHeight }}\n    >\n      <div className=\"distri-chat-container\">\n        {/* Messages Area */}\n        <div \n          ref={messagesContainerRef}\n          className=\"flex-1 overflow-y-auto distri-scroll p-4 space-y-4\"\n        >\n          {error && (\n            <div className=\"p-4 border border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800 rounded-lg\">\n              <p className=\"text-red-600 dark:text-red-400 text-sm\">\n                Error: {error.message}\n              </p>\n            </div>\n          )}\n\n          {messages.length === 0 && !loading && (\n            <div className=\"flex-1 flex items-center justify-center py-12\">\n              <div className=\"text-center max-w-sm\">\n                <div className=\"w-12 h-12 bg-blue-100 dark:bg-blue-900/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Send className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\n                </div>\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2\">\n                  Start a conversation\n                </h3>\n                <p className=\"text-gray-500 dark:text-gray-400 text-sm\">\n                  Send a message to begin chatting with the AI assistant.\n                </p>\n              </div>\n            </div>\n          )}\n\n          {renderedMessages}\n\n          {/* Loading indicator */}\n          {(loading || isStreaming) && (\n            <div className=\"flex items-center space-x-2 text-gray-500 dark:text-gray-400 p-4\">\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n              <span className=\"text-sm\">AI is thinking...</span>\n            </div>\n          )}\n\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Input Area */}\n        <div className=\"border-t border-gray-200 dark:border-gray-700 p-4\">\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"flex-1 relative\">\n              <textarea\n                value={input}\n                onChange={(e) => setInput(e.target.value)}\n                onKeyPress={handleKeyPress}\n                placeholder={placeholder}\n                rows={1}\n                className=\"distri-input w-full resize-none px-4 py-3 pr-12 text-sm min-h-[52px] max-h-32\"\n                disabled={loading || isStreaming}\n                style={{ \n                  minHeight: '52px',\n                  maxHeight: '128px',\n                }}\n              />\n              <button\n                onClick={sendMessage}\n                disabled={!input.trim() || loading || isStreaming}\n                className=\"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 distri-button-primary disabled:opacity-50 disabled:cursor-not-allowed transition-opacity\"\n              >\n                <Send className=\"h-4 w-4\" />\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default EmbeddableChat;","import React from 'react';\nimport { User, Bot, Settings, Clock, CheckCircle, XCircle, Brain } from 'lucide-react';\nimport { ToolCallState, ToolCall } from '@distri/core';\nimport MessageRenderer from './MessageRenderer';\n\nexport interface BaseMessageProps {\n  content?: string;\n  timestamp?: Date;\n  className?: string;\n  avatar?: React.ReactNode;\n}\n\nexport interface UserMessageProps extends BaseMessageProps {\n  content: string;\n}\n\nexport interface AssistantMessageProps extends BaseMessageProps {\n  content: string;\n  isStreaming?: boolean;\n  metadata?: any;\n}\n\nexport interface ToolCallProps {\n  toolCall: ToolCall | ToolCallState;\n  status?: 'pending' | 'running' | 'completed' | 'error';\n  result?: any;\n  error?: string;\n}\n\nexport interface AssistantWithToolCallsProps extends AssistantMessageProps {\n  toolCalls: ToolCallProps[];\n}\n\nexport interface PlanMessageProps extends BaseMessageProps {\n  content: string;\n  duration?: number;\n  timestamp?: Date;\n}\n\n// Base Message Container\nexport const MessageContainer: React.FC<{\n  children: React.ReactNode;\n  align: 'left' | 'right' | 'center';\n  className?: string;\n}> = ({ children, align, className = '' }) => {\n  const justifyClass = align === 'right' ? 'justify-end' : align === 'center' ? 'justify-center' : 'justify-start';\n\n  return (\n    <div className={`flex ${justifyClass} w-full ${className} mb-4`}>\n      <div className=\"w-full max-w-4xl mx-auto px-4\">\n        {children}\n      </div>\n    </div>\n  );\n};\n\n// Plan Message Component\nexport const PlanMessage: React.FC<PlanMessageProps> = ({\n  content,\n  duration,\n  timestamp,\n  className = ''\n}) => {\n  return (\n    <MessageContainer align=\"center\" className={`bg-gray-800 ${className}`}>\n      <div className=\"flex items-start gap-4 py-6\">\n        <div className=\"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center bg-purple-600\">\n          <Brain className=\"h-4 w-4 text-white\" />\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"text-sm font-medium text-white mb-1 flex items-center gap-2\">\n            Thought{duration ? ` for ${duration}s` : ''}\n          </div>\n          <div className=\"prose prose-sm max-w-none prose-invert\">\n            <MessageRenderer\n              content={content}\n              className=\"text-white\"\n            />\n          </div>\n          {timestamp && (\n            <div className=\"text-xs text-gray-400 mt-2\">\n              {timestamp.toLocaleTimeString()}\n            </div>\n          )}\n        </div>\n      </div>\n    </MessageContainer>\n  );\n};\n\n// User Message Component\nexport const UserMessage: React.FC<UserMessageProps> = ({\n  content,\n  timestamp,\n  className = '',\n  avatar\n}) => {\n  return (\n    <MessageContainer align=\"center\" className={className}>\n      <div className=\"flex items-start gap-4 py-6\">\n        <div className=\"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center bg-blue-600\">\n          {avatar || <User className=\"h-4 w-4 text-white\" />}\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"text-sm font-medium text-white mb-1\">You</div>\n          <div className=\"prose prose-sm max-w-none prose-invert\">\n            <MessageRenderer\n              content={content}\n              className=\"text-white\"\n            />\n          </div>\n          {timestamp && (\n            <div className=\"text-xs text-gray-400 mt-2\">\n              {timestamp.toLocaleTimeString()}\n            </div>\n          )}\n        </div>\n      </div>\n    </MessageContainer>\n  );\n};\n\n// Assistant Message Component\nexport const AssistantMessage: React.FC<AssistantMessageProps> = ({\n  content,\n  timestamp,\n  isStreaming = false,\n  metadata,\n  className = '',\n  avatar\n}) => {\n  return (\n    <MessageContainer align=\"center\" className={`bg-gray-800 ${className}`}>\n      <div className=\"flex items-start gap-4 py-6\">\n        <div className=\"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center bg-green-600\">\n          {avatar || <Bot className=\"h-4 w-4 text-white\" />}\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"text-sm font-medium text-white mb-1 flex items-center gap-2\">\n            Assistant\n            {isStreaming && (\n              <div className=\"flex items-center gap-1 text-xs text-gray-400\">\n                <div className=\"w-1 h-1 bg-gray-400 rounded-full animate-pulse\"></div>\n                <div className=\"w-1 h-1 bg-gray-400 rounded-full animate-pulse delay-75\"></div>\n                <div className=\"w-1 h-1 bg-gray-400 rounded-full animate-pulse delay-150\"></div>\n              </div>\n            )}\n          </div>\n          <div className=\"prose prose-sm max-w-none prose-invert\">\n            <MessageRenderer\n              content={content}\n              className=\"text-white\"\n              metadata={metadata}\n            />\n          </div>\n          {timestamp && (\n            <div className=\"text-xs text-gray-400 mt-2\">\n              {timestamp.toLocaleTimeString()}\n            </div>\n          )}\n        </div>\n      </div>\n    </MessageContainer>\n  );\n};\n\n// Tool Call Component\nexport const Tool: React.FC<ToolCallProps> = ({\n  toolCall,\n  status = 'pending',\n  result,\n  error\n}) => {\n  const [isExpanded, setIsExpanded] = React.useState(true);\n\n  const getStatusIcon = () => {\n    switch (status) {\n      case 'pending':\n        return <Clock className=\"h-4 w-4 text-gray-400\" />;\n      case 'running':\n        return <Settings className=\"h-4 w-4 text-blue-500 animate-spin\" />;\n      case 'completed':\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\n      case 'error':\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\n      default:\n        return <Clock className=\"h-4 w-4 text-gray-400\" />;\n    }\n  };\n\n  const getStatusColor = () => {\n    switch (status) {\n      case 'pending':\n        return 'border-gray-600 bg-gray-800';\n      case 'running':\n        return 'border-blue-600 bg-blue-900';\n      case 'completed':\n        return 'border-green-600 bg-green-900';\n      case 'error':\n        return 'border-red-600 bg-red-900';\n      default:\n        return 'border-gray-600 bg-gray-800';\n    }\n  };\n\n  const toolName = 'tool_name' in toolCall ? toolCall.tool_name : (toolCall as any).tool_name;\n  const toolId = 'tool_call_id' in toolCall ? toolCall.tool_call_id : (toolCall as any).tool_call_id;\n  const input = 'input' in toolCall ? toolCall.input : (toolCall as any).args;\n\n  // Always show the expand/collapse button if there's any content\n  const shouldShowExpand = input || result || error;\n\n  return (\n    <div className={`border rounded-lg ${getStatusColor()}`}>\n      <div\n        className=\"flex items-center gap-2 p-4 cursor-pointer hover:bg-gray-700 transition-colors\"\n        onClick={() => setIsExpanded(!isExpanded)}\n      >\n        {getStatusIcon()}\n        <span className=\"font-medium text-sm text-white flex-1\">{toolName}</span>\n        <span className=\"text-xs text-gray-400 font-mono\">{toolId}</span>\n        {shouldShowExpand && (\n          <button className=\"text-gray-400 hover:text-white transition-colors\">\n            {isExpanded ? (\n              <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n              </svg>\n            ) : (\n              <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n              </svg>\n            )}\n          </button>\n        )}\n      </div>\n\n      {isExpanded && (\n        <div className=\"px-4 pb-4 space-y-3\">\n          {input && (\n            <div>\n              <div className=\"text-xs font-medium text-gray-300 mb-1\">Input:</div>\n              <div className=\"text-sm bg-gray-700 rounded border border-gray-600 p-2 font-mono text-white\">\n                {typeof input === 'string' ? input : JSON.stringify(input, null, 2)}\n              </div>\n            </div>\n          )}\n\n          {result && (\n            <div>\n              <div className=\"text-xs font-medium text-gray-300 mb-1\">Result:</div>\n              <div className=\"text-sm bg-gray-700 rounded border border-gray-600 p-2 font-mono text-white\">\n                {typeof result === 'string' ? result : JSON.stringify(result, null, 2)}\n              </div>\n            </div>\n          )}\n\n          {error && (\n            <div>\n              <div className=\"text-xs font-medium text-red-400 mb-1\">Error:</div>\n              <div className=\"text-sm bg-red-900 rounded border border-red-700 p-2 text-red-200\">\n                {error}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Assistant with Tool Calls Component\nexport const AssistantWithToolCalls: React.FC<AssistantWithToolCallsProps> = ({\n  content,\n  toolCalls,\n  timestamp,\n  isStreaming = false,\n  metadata,\n  className = '',\n  avatar\n}) => {\n  return (\n    <MessageContainer align=\"center\" className={`bg-gray-800 ${className}`}>\n      <div className=\"flex items-start gap-4 py-6\">\n        <div className=\"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center bg-green-600\">\n          {avatar || <Bot className=\"h-4 w-4 text-white\" />}\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"text-sm font-medium text-white mb-1 flex items-center gap-2\">\n            Assistant\n            {isStreaming && (\n              <div className=\"flex items-center gap-1 text-xs text-gray-400\">\n                <div className=\"w-1 h-1 bg-gray-400 rounded-full animate-pulse\"></div>\n                <div className=\"w-1 h-1 bg-gray-400 rounded-full animate-pulse delay-75\"></div>\n                <div className=\"w-1 h-1 bg-gray-400 rounded-full animate-pulse delay-150\"></div>\n              </div>\n            )}\n          </div>\n\n          {content && (\n            <div className=\"prose prose-sm max-w-none mb-4 prose-invert\">\n              <MessageRenderer\n                content={content}\n                className=\"text-white\"\n                metadata={metadata}\n              />\n            </div>\n          )}\n\n          {toolCalls.length > 0 && (\n            <div className=\"space-y-3\">\n              {toolCalls.map((toolCallProps, index) => (\n                <Tool key={index} {...toolCallProps} />\n              ))}\n            </div>\n          )}\n\n          {timestamp && (\n            <div className=\"text-xs text-gray-400 mt-2\">\n              {timestamp.toLocaleTimeString()}\n            </div>\n          )}\n        </div>\n      </div>\n    </MessageContainer>\n  );\n};","import React, { useMemo } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport { vscDarkPlus, oneLight } from 'react-syntax-highlighter/dist/esm/styles/prism';\nimport { Copy, Check, Code2 } from 'lucide-react';\nimport { useChatConfig } from './ChatContext';\n\ninterface MessageRendererProps {\n  content: string;\n  className?: string;\n  metadata?: any;\n}\n\n// Enhanced Code Block Component with better overflow handling\nconst CodeBlock: React.FC<{\n  language: string;\n  children: string;\n  inline?: boolean;\n  isDark?: boolean;\n}> = ({ language, children, inline = false, isDark = false }) => {\n  const [copied, setCopied] = React.useState(false);\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(children);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy text: ', err);\n    }\n  };\n\n  // Enhanced language detection and normalization\n  const normalizeLanguage = (lang: string): string => {\n    if (!lang) return 'text';\n\n    const langMap: Record<string, string> = {\n      'js': 'javascript',\n      'ts': 'typescript',\n      'jsx': 'javascript',\n      'tsx': 'typescript',\n      'py': 'python',\n      'rb': 'ruby',\n      'sh': 'bash',\n      'shell': 'bash',\n      'yml': 'yaml',\n      'md': 'markdown',\n      'json5': 'json',\n      'dockerfile': 'docker',\n      'rs': 'rust',\n      'go': 'go',\n      'php': 'php',\n      'cpp': 'cpp',\n      'cxx': 'cpp',\n      'cc': 'cpp',\n      'c++': 'cpp',\n      'cs': 'csharp',\n      'kt': 'kotlin',\n      'swift': 'swift',\n      'scala': 'scala',\n      'clj': 'clojure',\n      'cljs': 'clojure',\n      'r': 'r',\n      'matlab': 'matlab',\n      'sql': 'sql',\n      'psql': 'sql',\n      'mysql': 'sql',\n      'sqlite': 'sql',\n    };\n\n    const normalized = lang.toLowerCase();\n    return langMap[normalized] || normalized;\n  };\n\n  const normalizedLanguage = normalizeLanguage(language);\n\n  if (inline) {\n    return (\n      <code className={`px-1.5 py-0.5 rounded text-sm font-mono ${isDark\n        ? 'bg-gray-700 text-gray-200'\n        : 'bg-gray-100 text-gray-800'\n        }`}>\n        {children}\n      </code>\n    );\n  }\n\n  const lineCount = children.split('\\n').length;\n  const shouldShowLineNumbers = lineCount > 4;\n\n  return (\n    <div className=\"relative my-4 rounded-lg border border-gray-200 bg-white overflow-hidden shadow-sm\">\n      <div className=\"flex items-center justify-between bg-gray-50 border-b border-gray-200 px-3 py-2 text-sm\">\n        <div className=\"flex items-center gap-2\">\n          <Code2 className=\"h-4 w-4 text-gray-500\" />\n          <span className=\"font-medium text-gray-700\">\n            {normalizedLanguage === 'text' ? 'Code' : normalizedLanguage.toUpperCase()}\n          </span>\n          <span className=\"text-gray-500 text-xs\">\n            {lineCount} {lineCount === 1 ? 'line' : 'lines'}\n          </span>\n        </div>\n        <button\n          onClick={handleCopy}\n          className=\"flex items-center gap-1 px-2 py-1 rounded hover:bg-gray-200 transition-colors text-gray-600 hover:text-gray-800\"\n          title=\"Copy code\"\n        >\n          {copied ? (\n            <>\n              <Check className=\"h-3 w-3\" />\n              <span className=\"text-xs\">Copied!</span>\n            </>\n          ) : (\n            <>\n              <Copy className=\"h-3 w-3\" />\n              <span className=\"text-xs\">Copy</span>\n            </>\n          )}\n        </button>\n      </div>\n      <div className=\"relative\">\n        <SyntaxHighlighter\n          style={isDark ? vscDarkPlus : oneLight}\n          language={normalizedLanguage}\n          PreTag=\"div\"\n          showLineNumbers={shouldShowLineNumbers}\n          wrapLines={true}\n          wrapLongLines={true}\n          lineNumberStyle={{\n            minWidth: '2.5em',\n            paddingRight: '1em',\n            color: '#9CA3AF',\n            fontSize: '0.75rem',\n            userSelect: 'none'\n          }}\n          customStyle={{\n            margin: 0,\n            padding: '0.75rem',\n            background: isDark ? '#1e1e1e' : '#fafafa',\n            fontSize: '0.875rem',\n            lineHeight: '1.5',\n            fontFamily: 'ui-monospace, SFMono-Regular, \"SF Mono\", Consolas, \"Liberation Mono\", Menlo, monospace',\n            overflowX: 'auto',\n            maxWidth: '100%',\n          }}\n          codeTagProps={{\n            style: {\n              fontSize: '0.875rem',\n              fontFamily: 'inherit',\n            }\n          }}\n        >\n          {children.replace(/\\n$/, '')}\n        </SyntaxHighlighter>\n      </div>\n    </div>\n  );\n};\n\nconst MessageRenderer: React.FC<MessageRendererProps> = ({\n  content,\n  className = \"\",\n}) => {\n  // Try to get chat config if available, otherwise use defaults\n  let config;\n  try {\n    const chatConfig = useChatConfig();\n    config = chatConfig.config;\n  } catch {\n    // If no chat context available, use defaults\n    config = {\n      enableMarkdown: true,\n      enableCodeHighlighting: true,\n      theme: 'chatgpt' as const\n    };\n  }\n\n  // Detect if we're in a dark theme context (e.g., user message with white text)\n  const isDark = className.includes('text-white');\n\n  // Enhanced markdown detection\n  const hasMarkdownSyntax = useMemo(() => {\n    if (!config.enableMarkdown) return false;\n\n    const markdownPatterns = [\n      /^#{1,6}\\s+/m, // Headers\n      /\\*\\*.*?\\*\\*/g, // Bold\n      /\\*.*?\\*/g, // Italic  \n      /`.*?`/g, // Inline code\n      /```[\\s\\S]*?```/g, // Code blocks\n      /^\\s*[-*+]\\s+/m, // Lists\n      /^\\s*\\d+\\.\\s+/m, // Numbered lists\n      /^\\s*>\\s+/m, // Blockquotes\n      /\\[.*?\\]\\(.*?\\)/g, // Links\n      /!\\[.*?\\]\\(.*?\\)/g, // Images\n      /^\\|.*\\|/m, // Tables\n    ];\n\n    return markdownPatterns.some(pattern => pattern.test(content));\n  }, [content, config.enableMarkdown]);\n\n  // Much more conservative code detection to avoid thoughts being marked as code\n  const looksLikeCode = useMemo(() => {\n    if (!config.enableCodeHighlighting) return false;\n    if (hasMarkdownSyntax) return false;\n\n    const lines = content.split('\\n');\n    const totalLines = lines.length;\n\n    // Don't treat short content as code\n    if (totalLines === 1 && content.length < 50) {\n      return false;\n    }\n\n    // Only trigger on very explicit code patterns - NOT thoughts or explanations\n    const explicitCodePatterns = [\n      /^#!\\//, // Shebang\n      /^\\s*(function|const|let|var)\\s+\\w+\\s*[=\\(]/, // JS/TS function/variable declarations\n      /^\\s*(class|interface)\\s+\\w+/, // Class/interface declarations\n      /^\\s*(import|export)\\s+/, // Import/export statements\n      /^\\s*(def|class)\\s+\\w+/, // Python def/class\n      /^\\s*(public|private|protected)\\s+(class|interface|static)/, // Java/C# declarations\n      /^\\s*<\\?php/, // PHP opening tag\n      /^\\s*<html|<head|<body|<div/, // HTML tags\n      /^\\s*\\{[\\s]*\"[\\w\"]+\"\\s*:/, // JSON objects (key-value pairs)\n      /^\\s*SELECT\\s+.*\\s+FROM\\s+/i, // SQL SELECT statements\n      /^\\s*\\/\\*[\\s\\S]*\\*\\//, // Block comments\n      /^[ \\t]*\\/\\/\\s*\\w+/, // Line comments (with actual content)\n      /;\\s*$/, // Lines ending with semicolons\n    ];\n\n    // Must have at least one very explicit code pattern\n    const hasExplicitCode = explicitCodePatterns.some(pattern => pattern.test(content));\n\n    if (!hasExplicitCode) return false;\n\n    // Additional verification: check for programming structure\n    const structuralPatterns = [\n      /[{}[\\]()]/g, // Brackets and braces\n      /^\\s{2,}/m, // Indentation\n      /=>/g, // Arrow functions\n      /[;:]/g, // Semicolons or colons\n    ];\n\n    const structureCount = structuralPatterns.reduce((count, pattern) => {\n      const matches = content.match(pattern);\n      return count + (matches ? matches.length : 0);\n    }, 0);\n\n    // Require both explicit code patterns AND structural elements\n    return structureCount >= 3;\n  }, [content, hasMarkdownSyntax, config.enableCodeHighlighting]);\n\n  // Try to detect language from content\n  const detectLanguage = useMemo((): string => {\n    if (/\\b(function|const|let|var|=>|console\\.log)\\b/.test(content)) return 'javascript';\n    if (/\\b(interface|type|as\\s+\\w+)\\b/.test(content)) return 'typescript';\n    if (/\\b(def|import|from|print|if\\s+\\w+:)\\b/.test(content)) return 'python';\n    if (/\\b(public\\s+class|static\\s+void|System\\.out)\\b/.test(content)) return 'java';\n    if (/\\b(fn|let\\s+mut|impl|match)\\b/.test(content)) return 'rust';\n    if (/\\b(func|package|import|fmt\\.)\\b/.test(content)) return 'go';\n    if (/SELECT.*FROM|INSERT.*INTO|UPDATE.*SET/i.test(content)) return 'sql';\n    if (/<[^>]+>.*<\\/[^>]+>/.test(content)) return 'html';\n    if (/\\{[^}]*:[^}]*\\}/.test(content)) return 'json';\n    if (/^#!\\/bin\\/(bash|sh)/.test(content)) return 'bash';\n    if (/\\$\\w+|echo\\s+/.test(content)) return 'bash';\n    return 'text';\n  }, [content]);\n\n  // Render based on content type\n  if (looksLikeCode) {\n    return (\n      <CodeBlock\n        language={detectLanguage}\n        isDark={isDark}\n      >\n        {content}\n      </CodeBlock>\n    );\n  }\n\n  if (!hasMarkdownSyntax) {\n    return (\n      <div className={`whitespace-pre-wrap break-words ${className}`}>\n        {content}\n      </div>\n    );\n  }\n\n  // Enhanced markdown rendering with better overflow handling\n  return (\n    <div className={`prose prose-sm max-w-none ${isDark ? 'prose-invert' : ''} ${className} break-words`}>\n      <ReactMarkdown\n        components={{\n          code({ className, children }) {\n            const match = /language-(\\w+)/.exec(className || '');\n            const language = match ? match[1] : '';\n\n            return (\n              <CodeBlock\n                language={language}\n                inline={true}\n                isDark={isDark}\n              >\n                {String(children).replace(/\\n$/, '')}\n              </CodeBlock>\n            );\n          },\n          // Enhanced blockquote styling\n          blockquote({ children }) {\n            return (\n              <blockquote className={`border-l-4 pl-4 py-2 italic my-4 rounded-r ${isDark\n                ? 'border-blue-400 text-blue-200 bg-blue-900/20'\n                : 'border-blue-500 text-blue-700 bg-blue-50'\n                }`}>\n                {children}\n              </blockquote>\n            );\n          },\n          // Enhanced table styling with overflow handling\n          table({ children }) {\n            return (\n              <div className=\"overflow-x-auto my-4\">\n                <table className={`min-w-full border-collapse rounded-lg overflow-hidden ${isDark ? 'border-gray-600' : 'border-gray-300'\n                  }`}>\n                  {children}\n                </table>\n              </div>\n            );\n          },\n          th({ children }) {\n            return (\n              <th className={`border px-4 py-2 font-semibold text-left ${isDark\n                ? 'border-gray-600 bg-gray-800'\n                : 'border-gray-300 bg-gray-100'\n                }`}>\n                {children}\n              </th>\n            );\n          },\n          td({ children }) {\n            return (\n              <td className={`border px-4 py-2 ${isDark ? 'border-gray-600' : 'border-gray-300'\n                }`}>\n                {children}\n              </td>\n            );\n          },\n        }}\n      >\n        {content}\n      </ReactMarkdown>\n    </div>\n  );\n};\n\nexport default MessageRenderer;","import React, { createContext, useContext, ReactNode } from 'react';\n\nexport type ChatTheme = 'light' | 'dark' | 'auto';\n\nexport interface ChatConfig {\n  theme: ChatTheme;\n  showDebug: boolean;\n  autoScroll: boolean;\n  showTimestamps: boolean;\n  enableMarkdown: boolean;\n  enableCodeHighlighting: boolean;\n}\n\nexport interface ChatContextValue {\n  config: ChatConfig;\n  updateConfig: (updates: Partial<ChatConfig>) => void;\n}\n\nconst defaultConfig: ChatConfig = {\n  theme: 'auto',\n  showDebug: false,\n  autoScroll: true,\n  showTimestamps: true,\n  enableMarkdown: true,\n  enableCodeHighlighting: true,\n};\n\nconst ChatContext = createContext<ChatContextValue | null>(null);\n\nexport interface ChatProviderProps {\n  children: ReactNode;\n  config?: Partial<ChatConfig>;\n}\n\nexport const ChatProvider: React.FC<ChatProviderProps> = ({ \n  children, \n  config: initialConfig = {} \n}) => {\n  const [config, setConfig] = React.useState<ChatConfig>({\n    ...defaultConfig,\n    ...initialConfig,\n  });\n\n  const updateConfig = React.useCallback((updates: Partial<ChatConfig>) => {\n    setConfig(prev => ({ ...prev, ...updates }));\n  }, []);\n\n  const value: ChatContextValue = {\n    config,\n    updateConfig,\n  };\n\n  return (\n    <ChatContext.Provider value={value}>\n      {children}\n    </ChatContext.Provider>\n  );\n};\n\nexport const useChatConfig = (): ChatContextValue => {\n  const context = useContext(ChatContext);\n  if (!context) {\n    // Return default values if used outside provider\n    return {\n      config: defaultConfig,\n      updateConfig: () => {},\n    };\n  }\n  return context;\n};\n\n/**\n * Utility function to get theme classes for components\n */\nexport const getThemeClasses = (theme: ChatTheme): string => {\n  switch (theme) {\n    case 'dark':\n      return 'dark';\n    case 'light':\n      return '';\n    case 'auto':\n    default:\n      // Use system preference\n      return typeof window !== 'undefined' && window.matchMedia('(prefers-color-scheme: dark)').matches \n        ? 'dark' \n        : '';\n  }\n};","// Utility functions for message handling\n\n/**\n * Utility function to extract text content from message parts\n */\nexport const extractTextFromMessage = (message: any): string => {\n  if (!message?.parts || !Array.isArray(message.parts)) {\n    return '';\n  }\n\n  return message.parts\n    .filter((part: any) => part?.kind === 'text' && part?.text)\n    .map((part: any) => part.text)\n    .join('') || '';\n};\n\n/**\n * Utility function to determine if a message should be displayed\n * Can be used by builders when creating custom chat components\n */\nexport const shouldDisplayMessage = (message: any, showDebugMessages: boolean = false): boolean => {\n  if (!message) return false;\n\n  // Always show user messages with content\n  if (message.role === 'user') {\n    const textContent = extractTextFromMessage(message);\n    return textContent.trim().length > 0;\n  }\n\n  // Check if message has text content\n  const textContent = extractTextFromMessage(message);\n  if (textContent.trim()) return true;\n\n  // Always show tool calls (visible by default, not just in debug mode)\n  if (message.metadata?.type === 'assistant_response' && message.metadata.tool_calls) {\n    return true;\n  }\n\n  // Show plan messages\n  if (message.metadata?.type === 'plan' || message.metadata?.plan) {\n    return true;\n  }\n\n  // Show other metadata messages only if debug is enabled\n  if (message.metadata?.type && message.metadata.type !== 'assistant_response') {\n    return showDebugMessages;\n  }\n\n  // Don't show empty messages\n  return false;\n};\n\n/**\n * Utility function to determine message type for rendering\n */\nexport const getMessageType = (message: any): 'user' | 'assistant' | 'assistant_with_tools' | 'plan' | 'system' => {\n  if (message.role === 'user') return 'user';\n  \n  if (message.metadata?.type === 'assistant_response' && message.metadata.tool_calls) {\n    return 'assistant_with_tools';\n  }\n  \n  if (message.metadata?.type === 'plan' || message.metadata?.plan) {\n    return 'plan';\n  }\n  \n  if (message.role === 'assistant') return 'assistant';\n  \n  return 'system';\n};\n\n/**\n * Utility function to format timestamps\n */\nexport const formatTimestamp = (timestamp: string | number | Date): string => {\n  const date = new Date(timestamp);\n  return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n};\n\n/**\n * Utility function to scroll to bottom of chat\n */\nexport const scrollToBottom = (element: HTMLElement | null, _behavior: ScrollBehavior = 'smooth') => {\n  if (element) {\n    element.scrollTop = element.scrollHeight;\n  }\n};","import React, { useState, useCallback } from 'react';\nimport { Plus, MessageSquare, Settings, MoreHorizontal, Trash2, Edit3, Bot, Users, BarChart3 } from 'lucide-react';\nimport { Agent } from '@distri/core';\nimport { useThreads } from '../useThreads';\nimport { EmbeddableChat } from './EmbeddableChat';\nimport '../styles/themes.css';\n\nexport interface FullChatProps {\n  agentId: string;\n  agent?: Agent;\n  metadata?: any;\n  className?: string;\n  // Available agents for selection\n  availableAgents?: Array<{ id: string; name: string; description?: string }>;\n  // Customization props\n  UserMessageComponent?: React.ComponentType<any>;\n  AssistantMessageComponent?: React.ComponentType<any>;\n  AssistantWithToolCallsComponent?: React.ComponentType<any>;\n  PlanMessageComponent?: React.ComponentType<any>;\n  // Theme\n  theme?: 'light' | 'dark' | 'auto';\n  // Show debug info\n  showDebug?: boolean;\n  // Sidebar\n  showSidebar?: boolean;\n  sidebarWidth?: number;\n  // Navigation\n  currentPage?: 'chat' | 'agents' | 'tasks';\n  onPageChange?: (page: 'chat' | 'agents' | 'tasks') => void;\n  // Callbacks\n  onAgentSelect?: (agentId: string) => void;\n  onThreadSelect?: (threadId: string) => void;\n  onThreadCreate?: (threadId: string) => void;\n  onThreadDelete?: (threadId: string) => void;\n  onLogoClick?: () => void;\n}\n\ninterface ThreadItemProps {\n  thread: any;\n  isActive: boolean;\n  onClick: () => void;\n  onDelete: () => void;\n  onRename: (newTitle: string) => void;\n}\n\nconst ThreadItem: React.FC<ThreadItemProps> = ({ \n  thread, \n  isActive, \n  onClick, \n  onDelete, \n  onRename \n}) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [editTitle, setEditTitle] = useState(thread.title || 'New Chat');\n  const [showMenu, setShowMenu] = useState(false);\n\n  const handleRename = useCallback(() => {\n    if (editTitle.trim() && editTitle !== thread.title) {\n      onRename(editTitle.trim());\n    }\n    setIsEditing(false);\n  }, [editTitle, thread.title, onRename]);\n\n  const handleKeyPress = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      handleRename();\n    } else if (e.key === 'Escape') {\n      setEditTitle(thread.title || 'New Chat');\n      setIsEditing(false);\n    }\n  }, [handleRename, thread.title]);\n\n  return (\n    <div \n      className={`group relative p-3 rounded-lg cursor-pointer transition-colors ${\n        isActive \n          ? 'bg-white/10 border border-white/20' \n          : 'hover:bg-white/5'\n      }`}\n      onClick={onClick}\n    >\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-3 flex-1 min-w-0\">\n          <MessageSquare className={`h-4 w-4 flex-shrink-0 ${isActive ? 'text-white' : 'text-white/60'}`} />\n          \n          {isEditing ? (\n            <input\n              value={editTitle}\n              onChange={(e) => setEditTitle(e.target.value)}\n              onBlur={handleRename}\n              onKeyPress={handleKeyPress}\n              className=\"flex-1 text-sm bg-transparent border-none outline-none text-white\"\n              autoFocus\n              onClick={(e) => e.stopPropagation()}\n            />\n          ) : (\n            <div className=\"flex-1 min-w-0\">\n              <p className={`text-sm font-medium truncate ${isActive ? 'text-white' : 'text-white/90'}`}>\n                {thread.title || 'New Chat'}\n              </p>\n              <p className=\"text-xs text-white/60 truncate\">\n                {thread.last_message || 'No messages yet'}\n              </p>\n            </div>\n          )}\n        </div>\n\n        {!isEditing && (\n          <div className=\"relative\">\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                setShowMenu(!showMenu);\n              }}\n              className=\"opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-white/10 transition-opacity\"\n            >\n              <MoreHorizontal className=\"h-4 w-4 text-white/60\" />\n            </button>\n\n            {showMenu && (\n              <div className=\"absolute right-0 top-6 w-32 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-10\">\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    setIsEditing(true);\n                    setShowMenu(false);\n                  }}\n                  className=\"w-full text-left px-3 py-2 text-sm hover:bg-gray-700 text-white flex items-center space-x-2 rounded-t-lg\"\n                >\n                  <Edit3 className=\"h-3 w-3\" />\n                  <span>Rename</span>\n                </button>\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onDelete();\n                    setShowMenu(false);\n                  }}\n                  className=\"w-full text-left px-3 py-2 text-sm hover:bg-gray-700 text-red-400 flex items-center space-x-2 rounded-b-lg\"\n                >\n                  <Trash2 className=\"h-3 w-3\" />\n                  <span>Delete</span>\n                </button>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport const FullChat: React.FC<FullChatProps> = ({\n  agentId,\n  agent,\n  metadata,\n  className = '',\n  availableAgents = [],\n  UserMessageComponent,\n  AssistantMessageComponent,\n  AssistantWithToolCallsComponent,\n  PlanMessageComponent,\n  theme = 'dark',\n  showDebug = false,\n  showSidebar = true,\n  sidebarWidth = 280,\n  currentPage = 'chat',\n  onPageChange,\n  onAgentSelect,\n  onThreadSelect,\n  onThreadCreate,\n  onThreadDelete,\n  onLogoClick,\n}) => {\n  const [selectedThreadId, setSelectedThreadId] = useState<string>('default');\n  const { threads, loading: threadsLoading, refetch: refetchThreads } = useThreads();\n\n  const handleNewChat = useCallback(() => {\n    const newThreadId = `thread-${Date.now()}`;\n    setSelectedThreadId(newThreadId);\n    onThreadCreate?.(newThreadId);\n  }, [onThreadCreate]);\n\n  const handleThreadSelect = useCallback((threadId: string) => {\n    setSelectedThreadId(threadId);\n    onThreadSelect?.(threadId);\n  }, [onThreadSelect]);\n\n  const handleThreadDelete = useCallback((threadId: string) => {\n    // If deleting the active thread, switch to a new one\n    if (threadId === selectedThreadId) {\n      const remainingThreads = threads.filter(t => t.id !== threadId);\n      if (remainingThreads.length > 0) {\n        setSelectedThreadId(remainingThreads[0].id);\n      } else {\n        handleNewChat();\n      }\n    }\n    onThreadDelete?.(threadId);\n    refetchThreads();\n  }, [selectedThreadId, threads, handleNewChat, onThreadDelete, refetchThreads]);\n\n  const handleThreadRename = useCallback((threadId: string, newTitle: string) => {\n    // In a real implementation, this would call an API to rename the thread\n    console.log('Rename thread', threadId, 'to', newTitle);\n    refetchThreads();\n  }, [refetchThreads]);\n\n  // Apply theme class\n  const themeClass = theme === 'auto' ? '' : theme;\n\n  const sidebarStyle = {\n    width: showSidebar ? `${sidebarWidth}px` : '0px',\n  };\n\n  const mainStyle = {\n    marginLeft: showSidebar ? `${sidebarWidth}px` : '0px',\n  };\n\n  // Get current agent\n  const currentAgent = availableAgents.find(a => a.id === agentId);\n\n  return (\n    <div className={`distri-chat ${themeClass} ${className} h-full flex bg-gray-900`}>\n      {/* Sidebar - ChatGPT Style */}\n      {showSidebar && (\n        <div \n          className=\"fixed left-0 top-0 h-full bg-gray-900 border-r border-gray-800 flex flex-col\"\n          style={sidebarStyle}\n        >\n          {/* Logo */}\n          <div className=\"p-4\">\n            <button \n              onClick={onLogoClick}\n              className=\"flex items-center space-x-2 text-white hover:bg-white/10 rounded-lg p-2 transition-colors w-full\"\n            >\n              <Bot className=\"h-6 w-6\" />\n              <span className=\"font-semibold\">Distri</span>\n            </button>\n          </div>\n\n          {/* New Chat Button */}\n          <div className=\"px-4 pb-4\">\n            <button\n              onClick={handleNewChat}\n              className=\"w-full flex items-center justify-center space-x-2 px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors\"\n            >\n              <Plus className=\"h-4 w-4\" />\n              <span className=\"text-sm font-medium\">New Chat</span>\n            </button>\n          </div>\n\n          {/* Agent Selection */}\n          {availableAgents.length > 0 && (\n            <div className=\"px-4 pb-4\">\n              <div className=\"text-xs text-white/60 mb-2 px-2\">Agent</div>\n              <select\n                value={agentId}\n                onChange={(e) => onAgentSelect?.(e.target.value)}\n                className=\"w-full bg-gray-800 border border-gray-700 text-white rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                {availableAgents.map((agent) => (\n                  <option key={agent.id} value={agent.id}>\n                    {agent.name}\n                  </option>\n                ))}\n              </select>\n              {currentAgent?.description && (\n                <p className=\"text-xs text-white/50 mt-1 px-2\">{currentAgent.description}</p>\n              )}\n            </div>\n          )}\n\n          {/* Navigation */}\n          <div className=\"px-4 pb-4\">\n            <div className=\"text-xs text-white/60 mb-2 px-2\">Navigation</div>\n            <div className=\"space-y-1\">\n              <button\n                onClick={() => onPageChange?.('chat')}\n                className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm transition-colors ${\n                  currentPage === 'chat' \n                    ? 'bg-white/10 text-white' \n                    : 'text-white/70 hover:bg-white/5 hover:text-white'\n                }`}\n              >\n                <MessageSquare className=\"h-4 w-4\" />\n                <span>Chat</span>\n              </button>\n              <button\n                onClick={() => onPageChange?.('agents')}\n                className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm transition-colors ${\n                  currentPage === 'agents' \n                    ? 'bg-white/10 text-white' \n                    : 'text-white/70 hover:bg-white/5 hover:text-white'\n                }`}\n              >\n                <Users className=\"h-4 w-4\" />\n                <span>Agents</span>\n              </button>\n              <button\n                onClick={() => onPageChange?.('tasks')}\n                className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm transition-colors ${\n                  currentPage === 'tasks' \n                    ? 'bg-white/10 text-white' \n                    : 'text-white/70 hover:bg-white/5 hover:text-white'\n                }`}\n              >\n                <BarChart3 className=\"h-4 w-4\" />\n                <span>Tasks</span>\n              </button>\n            </div>\n          </div>\n\n          {/* Threads List - Only show when on chat page */}\n          {currentPage === 'chat' && (\n            <div className=\"flex-1 overflow-y-auto px-4 space-y-2 distri-scroll\">\n              <div className=\"text-xs text-white/60 mb-2 px-2\">Conversations</div>\n              {threadsLoading ? (\n                <div className=\"text-center py-8\">\n                  <div className=\"text-sm text-white/60\">Loading threads...</div>\n                </div>\n              ) : threads.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <MessageSquare className=\"h-8 w-8 text-white/30 mx-auto mb-2\" />\n                  <div className=\"text-sm text-white/60\">No conversations yet</div>\n                </div>\n              ) : (\n                threads.map((thread: any) => (\n                  <ThreadItem\n                    key={thread.id}\n                    thread={thread}\n                    isActive={thread.id === selectedThreadId}\n                    onClick={() => handleThreadSelect(thread.id)}\n                    onDelete={() => handleThreadDelete(thread.id)}\n                    onRename={(newTitle) => handleThreadRename(thread.id, newTitle)}\n                  />\n                ))\n              )}\n            </div>\n          )}\n\n          {/* Settings */}\n          <div className=\"p-4 border-t border-gray-800\">\n            <button className=\"w-full flex items-center space-x-3 px-3 py-2 text-white/70 hover:bg-white/10 rounded-lg transition-colors\">\n              <Settings className=\"h-4 w-4\" />\n              <span className=\"text-sm\">Settings</span>\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Main Chat Area - Only show when on chat page */}\n      {currentPage === 'chat' && (\n        <div className=\"flex-1\" style={mainStyle}>\n          <EmbeddableChat\n            agentId={agentId}\n            threadId={selectedThreadId}\n            agent={agent}\n            metadata={metadata}\n            height=\"100vh\"\n            UserMessageComponent={UserMessageComponent}\n            AssistantMessageComponent={AssistantMessageComponent}\n            AssistantWithToolCallsComponent={AssistantWithToolCallsComponent}\n            PlanMessageComponent={PlanMessageComponent}\n            theme={theme}\n            showDebug={showDebug}\n            placeholder=\"Type your message...\"\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default FullChat;","import React from 'react';\nimport { Agent } from '@distri/core';\nimport { EmbeddableChat } from './EmbeddableChat';\nimport { FullChat } from './FullChat';\nimport '../styles/themes.css';\n\nexport interface ChatContainerProps {\n  agentId: string;\n  agent?: Agent;\n  metadata?: any;\n  \n  // Layout options\n  variant?: 'embedded' | 'full';\n  height?: string | number;\n  className?: string;\n  \n  // Threading (only for full variant)\n  threadId?: string;\n  showSidebar?: boolean;\n  sidebarWidth?: number;\n  \n  // Appearance\n  theme?: 'light' | 'dark' | 'auto';\n  placeholder?: string;\n  \n  // Functionality\n  showDebug?: boolean;\n  \n  // Customization\n  UserMessageComponent?: React.ComponentType<any>;\n  AssistantMessageComponent?: React.ComponentType<any>;\n  AssistantWithToolCallsComponent?: React.ComponentType<any>;\n  PlanMessageComponent?: React.ComponentType<any>;\n  \n  // Callbacks\n  onMessageSent?: (message: string) => void;\n  onResponse?: (response: any) => void;\n  onThreadSelect?: (threadId: string) => void;\n  onThreadCreate?: (threadId: string) => void;\n  onThreadDelete?: (threadId: string) => void;\n}\n\n/**\n * ChatContainer - A ready-to-use chat component for Distri agents\n * \n * This is the main component developers should use. It provides:\n * - Embedded variant: Simple chat interface for embedding in existing UIs\n * - Full variant: Complete chat application with threads sidebar\n * - Theme support: Light/dark/auto themes compatible with shadcn/ui\n * - Tool support: Automatic tool execution with visual feedback\n * - Customization: Override any message component\n * \n * @example\n * ```tsx\n * // Simple embedded chat\n * <ChatContainer agentId=\"my-agent\" variant=\"embedded\" height={400} />\n * \n * // Full chat with threads\n * <ChatContainer agentId=\"my-agent\" variant=\"full\" />\n * \n * // With custom components\n * <ChatContainer \n *   agentId=\"my-agent\" \n *   UserMessageComponent={CustomUserMessage}\n *   theme=\"dark\"\n * />\n * ```\n */\nexport const ChatContainer: React.FC<ChatContainerProps> = ({\n  variant = 'embedded',\n  height = 500,\n  theme = 'auto',\n  showDebug = false,\n  placeholder = \"Type your message...\",\n  ...props\n}) => {\n  if (variant === 'full') {\n    return (\n      <FullChat\n        {...props}\n        theme={theme}\n        showDebug={showDebug}\n      />\n    );\n  }\n\n  return (\n    <EmbeddableChat\n      {...props}\n      height={height}\n      theme={theme}\n      showDebug={showDebug}\n      placeholder={placeholder}\n    />\n  );\n};\n\nexport default ChatContainer;","import React, { useState } from 'react';\nimport { AlertTriangle, CheckCircle, XCircle } from 'lucide-react';\nimport { ToolCall } from '@distri/core';\n\nexport interface ApprovalDialogProps {\n  toolCalls: ToolCall[];\n  reason?: string;\n  onApprove: () => void;\n  onDeny: () => void;\n  onCancel: () => void;\n}\n\nconst ApprovalDialog: React.FC<ApprovalDialogProps> = ({\n  toolCalls,\n  reason,\n  onApprove,\n  onDeny,\n  onCancel\n}) => {\n  const [isVisible, setIsVisible] = useState(true);\n\n  if (!isVisible) return null;\n\n  const handleApprove = () => {\n    setIsVisible(false);\n    onApprove();\n  };\n\n  const handleDeny = () => {\n    setIsVisible(false);\n    onDeny();\n  };\n\n  const handleCancel = () => {\n    setIsVisible(false);\n    onCancel();\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4\">\n        <div className=\"flex items-center p-4 border-b border-gray-200\">\n          <AlertTriangle className=\"w-6 h-6 text-yellow-500 mr-3\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">Tool Execution Approval</h3>\n        </div>\n\n        <div className=\"p-4\">\n          {reason && (\n            <div className=\"mb-4\">\n              <p className=\"text-sm text-gray-700\">{reason}</p>\n            </div>\n          )}\n\n          <div className=\"mb-4\">\n            <h4 className=\"text-sm font-medium text-gray-900 mb-2\">Tools to execute:</h4>\n            <div className=\"space-y-2\">\n              {toolCalls.map((toolCall) => (\n                <div key={toolCall.tool_call_id} className=\"flex items-center p-2 bg-gray-50 rounded\">\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium text-gray-900\">{toolCall.tool_name}</p>\n                    {toolCall.input && (\n                      <p className=\"text-xs text-gray-600 mt-1\">\n                        {typeof toolCall.input === 'string'\n                          ? toolCall.input\n                          : JSON.stringify(toolCall.input)\n                        }\n                      </p>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"flex space-x-3\">\n            <button\n              onClick={handleApprove}\n              className=\"flex-1 flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors\"\n            >\n              <CheckCircle className=\"w-4 h-4 mr-2\" />\n              Approve\n            </button>\n            <button\n              onClick={handleDeny}\n              className=\"flex-1 flex items-center justify-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors\"\n            >\n              <XCircle className=\"w-4 h-4 mr-2\" />\n              Deny\n            </button>\n            <button\n              onClick={handleCancel}\n              className=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors\"\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ApprovalDialog; ","import React, { useState, useEffect } from 'react';\nimport { CheckCircle, XCircle, AlertTriangle, Info, X } from 'lucide-react';\n\nexport interface ToastProps {\n  message: string;\n  type?: 'success' | 'error' | 'warning' | 'info';\n  duration?: number;\n  onClose?: () => void;\n}\n\nconst Toast: React.FC<ToastProps> = ({\n  message,\n  type = 'info',\n  duration = 3000,\n  onClose\n}) => {\n  const [isVisible, setIsVisible] = useState(true);\n\n  useEffect(() => {\n    if (duration > 0) {\n      const timer = setTimeout(() => {\n        setIsVisible(false);\n        setTimeout(() => onClose?.(), 300); // Wait for fade out animation\n      }, duration);\n      return () => clearTimeout(timer);\n    }\n  }, [duration, onClose]);\n\n  const getIcon = () => {\n    switch (type) {\n      case 'success':\n        return <CheckCircle className=\"w-5 h-5 text-green-500\" />;\n      case 'error':\n        return <XCircle className=\"w-5 h-5 text-red-500\" />;\n      case 'warning':\n        return <AlertTriangle className=\"w-5 h-5 text-yellow-500\" />;\n      case 'info':\n      default:\n        return <Info className=\"w-5 h-5 text-blue-500\" />;\n    }\n  };\n\n  const getBgColor = () => {\n    switch (type) {\n      case 'success':\n        return 'bg-green-50 border-green-200';\n      case 'error':\n        return 'bg-red-50 border-red-200';\n      case 'warning':\n        return 'bg-yellow-50 border-yellow-200';\n      case 'info':\n      default:\n        return 'bg-blue-50 border-blue-200';\n    }\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <div className={`fixed top-4 right-4 z-50 max-w-sm w-full ${getBgColor()} border rounded-lg shadow-lg transition-opacity duration-300 ${isVisible ? 'opacity-100' : 'opacity-0'}`}>\n      <div className=\"flex items-start p-4\">\n        <div className=\"flex-shrink-0\">\n          {getIcon()}\n        </div>\n        <div className=\"ml-3 flex-1\">\n          <p className=\"text-sm font-medium text-gray-900\">{message}</p>\n        </div>\n        <div className=\"ml-4 flex-shrink-0\">\n          <button\n            onClick={() => {\n              setIsVisible(false);\n              setTimeout(() => onClose?.(), 300);\n            }}\n            className=\"inline-flex text-gray-400 hover:text-gray-600 focus:outline-none\"\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Toast; ","import React, { useState, useRef, useEffect, useCallback, useMemo } from 'react';\nimport { Send, Loader2, Square, Eye, EyeOff, Bot } from 'lucide-react';\nimport { Agent } from '@distri/core';\nimport { useChatConfig, ChatProvider } from './ChatContext';\nimport { useChat } from '../useChat';\nimport { UserMessage, AssistantMessage, AssistantWithToolCalls, PlanMessage } from './MessageComponents';\n\nexport interface ChatProps {\n  agentId: string;\n  threadId: string;\n  agent?: Agent;\n  // Backwards compatibility: tools prop for legacy external tool handlers\n  tools?: Record<string, any>;\n  metadata?: any;\n  height?: string;\n  onThreadUpdate?: (threadId: string) => void;\n  className?: string;\n  // Customization props\n  placeholder?: string;\n  // Custom message components for full customization\n  UserMessageComponent?: React.ComponentType<any>;\n  AssistantMessageComponent?: React.ComponentType<any>;\n  AssistantWithToolCallsComponent?: React.ComponentType<any>;\n  PlanMessageComponent?: React.ComponentType<any>;\n  // Custom external tool handler (for backwards compatibility)\n  onExternalToolCall?: (toolCall: any) => void;\n}\n\nconst ChatInput: React.FC<{\n  value: string;\n  onChange: (value: string) => void;\n  onSend: () => void;\n  disabled: boolean;\n  isStreaming: boolean;\n  placeholder?: string;\n}> = ({ value, onChange, onSend, disabled, isStreaming, placeholder = \"Type a message...\" }) => {\n\n  const handleKeyPress = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      onSend();\n    }\n  }, [onSend]);\n\n  return (\n    <div className=\"border-t border-gray-700 bg-gray-900 p-4\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"flex gap-3 items-end\">\n          <div className=\"flex-1 relative flex gap-2 items-center\">\n            <textarea\n              value={value}\n              onChange={(e) => onChange(e.target.value)}\n              onKeyPress={handleKeyPress}\n              placeholder={placeholder}\n              rows={1}\n              className=\"w-full resize-none rounded-xl border border-gray-600 px-4 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-800 text-white placeholder-gray-400\"\n              style={{ minHeight: '52px', maxHeight: '200px' }}\n              disabled={disabled}\n            />\n            <button\n              onClick={onSend}\n              disabled={!value.trim() || disabled}\n              className=\"absolute right-3 h-12 w-12 bottom-3 p-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors flex items-center justify-center\"\n            >\n              {isStreaming ? (\n                <Square className=\"h-4 w-4\" />\n              ) : (\n                <Send className=\"h-4 w-4\" />\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst DebugToggle: React.FC<{\n  showDebug: boolean;\n  onToggle: () => void;\n}> = ({ showDebug, onToggle }) => {\n  return (\n    <button\n      onClick={onToggle}\n      className=\"flex items-center gap-2 px-3 py-1 text-sm border border-gray-600 rounded-lg hover:bg-gray-800 transition-colors text-white\"\n    >\n      {showDebug ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n      Debug\n    </button>\n  );\n};\n\nconst ChatContent: React.FC<ChatProps> = ({\n  agentId,\n  threadId,\n  agent,\n  tools,\n  metadata,\n  height = \"600px\",\n  onThreadUpdate,\n  placeholder = \"Type a message...\",\n  UserMessageComponent = UserMessage,\n  AssistantMessageComponent = AssistantMessage,\n  AssistantWithToolCallsComponent = AssistantWithToolCalls,\n  PlanMessageComponent = PlanMessage,\n  onExternalToolCall,\n}) => {\n  const [input, setInput] = useState('');\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const { config, updateConfig } = useChatConfig();\n\n  const {\n    messages,\n    loading,\n    error,\n    isStreaming,\n    sendMessageStream,\n  } = useChat({\n    agentId,\n    threadId,\n    agent,\n    metadata,\n  });\n\n  // Legacy tool handling for backwards compatibility\n  useEffect(() => {\n    if (tools && onExternalToolCall) {\n      console.warn('Legacy tools prop detected. Consider migrating to the new useTools hook for better performance.');\n    }\n  }, [tools, onExternalToolCall]);\n\n  // Helper function to extract text from message parts\n  const extractTextFromMessage = useCallback((message: any): string => {\n    if (!message?.parts || !Array.isArray(message.parts)) {\n      return '';\n    }\n\n    return message.parts\n      .filter((part: any) => part?.kind === 'text' && part?.text)\n      .map((part: any) => part.text)\n      .join('') || '';\n  }, []);\n\n  // Helper function to check if message should be displayed\n  const shouldDisplayMessage = useCallback((message: any): boolean => {\n    if (!message) return false;\n\n    // Always show user messages with content\n    if (message.role === 'user') {\n      const textContent = extractTextFromMessage(message);\n      return textContent.trim().length > 0;\n    }\n\n    // Check if message has text content\n    const textContent = extractTextFromMessage(message);\n    if (textContent.trim()) return true;\n\n    // Always show tool calls (they should be visible regardless of debug mode)\n    if (message.metadata?.type === 'assistant_response' && message.metadata.tool_calls) {\n      return true;\n    }\n\n    // Show plan messages\n    if (message.metadata?.type === 'plan' || message.metadata?.plan) {\n      return true;\n    }\n\n    // Show other metadata messages only if debug is enabled (like \"run started\", etc.)\n    if (message.metadata?.type && message.metadata.type !== 'assistant_response') {\n      return config.showDebug;\n    }\n\n    // Don't show empty messages\n    return false;\n  }, [extractTextFromMessage, config.showDebug]);\n\n  const scrollToBottom = useCallback(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, []);\n\n  useEffect(() => {\n    if (threadId && messages.length > 0) {\n      scrollToBottom();\n    }\n  }, [messages, threadId, scrollToBottom]);\n\n  const sendMessage = useCallback(async () => {\n    if (!input.trim() || loading || isStreaming) return;\n\n    const messageText = input.trim();\n    setInput('');\n\n    try {\n      await sendMessageStream(messageText);\n      onThreadUpdate?.(threadId);\n    } catch (error) {\n      console.error('Failed to send message:', error);\n      setInput(messageText);\n    }\n  }, [input, loading, isStreaming, sendMessageStream, onThreadUpdate, threadId]);\n\n  // Render messages using custom components\n  const renderedMessages = useMemo(() => {\n    return messages\n      .filter(shouldDisplayMessage)\n      .map((message: any, index: number) => {\n        const timestamp = new Date(message.timestamp || Date.now());\n        const messageText = extractTextFromMessage(message);\n        const isUser = message.role === 'user';\n\n        // Handle user messages\n        if (isUser) {\n          return (\n            <UserMessageComponent\n              key={message.messageId || `user-${index}`}\n              content={messageText}\n              timestamp={timestamp}\n            />\n          );\n        }\n\n        // Handle assistant messages with tool calls\n        if (message.metadata?.type === 'assistant_response' && message.metadata.tool_calls) {\n          const toolCallsProps = message.metadata.tool_calls.map((toolCall: any) => ({\n            toolCall,\n            status: 'completed', // Tools are executed immediately now\n            result: 'Tool executed successfully',\n            error: null,\n          }));\n\n          return (\n            <AssistantWithToolCallsComponent\n              key={message.messageId || `assistant-tools-${index}`}\n              content={messageText}\n              toolCalls={toolCallsProps}\n              timestamp={timestamp}\n              isStreaming={isStreaming && index === messages.length - 1}\n              metadata={message.metadata}\n            />\n          );\n        }\n\n        // Handle plan messages\n        if (message.metadata?.type === 'plan' || message.metadata?.plan) {\n          return (\n            <PlanMessageComponent\n              key={message.messageId || `plan-${index}`}\n              content={messageText || message.metadata?.plan || 'Planning...'}\n              duration={message.metadata?.duration}\n              timestamp={timestamp}\n            />\n          );\n        }\n\n        // Handle regular assistant messages\n        return (\n          <AssistantMessageComponent\n            key={message.messageId || `assistant-${index}`}\n            content={messageText || 'Empty message'}\n            timestamp={timestamp}\n            isStreaming={isStreaming && index === messages.length - 1}\n            metadata={message.metadata}\n          />\n        );\n      });\n  }, [messages, shouldDisplayMessage, extractTextFromMessage, isStreaming, UserMessageComponent, AssistantMessageComponent, AssistantWithToolCallsComponent, PlanMessageComponent]);\n\n  return (\n    <div className=\"flex flex-col bg-gray-900 text-white\" style={{ height }}>\n      {/* Header */}\n      <div className=\"flex-shrink-0 border-b border-gray-700 bg-gray-900 p-4\">\n        <div className=\"max-w-4xl mx-auto flex items-center justify-between\">\n          <div>\n            {agent && (\n              <>\n                <h2 className=\"text-lg font-semibold text-white\">{agent.name}</h2>\n                <p className=\"text-sm text-gray-400\">{agent.description}</p>\n              </>\n            )}\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <DebugToggle\n              showDebug={config.showDebug}\n              onToggle={() => updateConfig({ showDebug: !config.showDebug })}\n            />\n            {(loading || isStreaming) && (\n              <div className=\"flex items-center text-blue-400\">\n                <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                <span className=\"text-sm\">Processing...</span>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto bg-gray-900\">\n        {error && (\n          <div className=\"max-w-4xl mx-auto px-4 py-4\">\n            <div className=\"bg-red-900 border border-red-700 rounded-lg p-4\">\n              <p className=\"text-red-200\">Error: {error.message}</p>\n            </div>\n          </div>\n        )}\n\n        <div className=\"min-h-full\">\n          {messages.length === 0 ? (\n            <div className=\"flex-1 flex items-center justify-center\">\n              <div className=\"text-center max-w-2xl mx-auto px-4\">\n                <div className=\"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-6\">\n                  <Bot className=\"h-8 w-8 text-white\" />\n                </div>\n                <h1 className=\"text-2xl font-semibold text-white mb-2\">\n                  {agent?.name || \"Assistant\"}\n                </h1>\n                <p className=\"text-gray-400 text-lg mb-8\">\n                  {agent?.description || \"How can I help you today?\"}\n                </p>\n                <div className=\"text-sm text-gray-500\">\n                  <p>Start a conversation by typing a message below.</p>\n                </div>\n              </div>\n            </div>\n          ) : (\n            renderedMessages\n          )}\n        </div>\n\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Input */}\n      <ChatInput\n        value={input}\n        onChange={setInput}\n        onSend={sendMessage}\n        disabled={loading}\n        isStreaming={isStreaming}\n        placeholder={placeholder}\n      />\n    </div>\n  );\n};\n\n// Main Chat component with provider\nexport const Chat: React.FC<ChatProps> = (props) => {\n  return (\n    <ChatProvider>\n      <ChatContent {...props} />\n    </ChatProvider>\n  );\n};\n\nexport default Chat;","import React, { useState, useCallback, useEffect } from 'react';\nimport { X, Loader2 } from 'lucide-react';\nimport { ToolCall, ToolResult } from '@distri/core';\nimport Toast from './Toast';\nimport ApprovalDialog from './ApprovalDialog';\nimport {\n  createBuiltinToolHandlers,\n  processExternalToolCalls,\n  initializeBuiltinHandlers,\n  clearPendingToolCalls\n} from '../builtinHandlers';\n\nexport interface ExternalToolManagerProps {\n  toolCalls: ToolCall[];\n  onToolComplete: (results: ToolResult[]) => void;\n  onCancel: () => void;\n}\n\ninterface ToastState {\n  id: string;\n  message: string;\n  type: 'success' | 'error' | 'warning' | 'info';\n}\n\ninterface ApprovalDialogState {\n  toolCalls: ToolCall[];\n  reason?: string;\n  resolve: (approved: boolean) => void;\n}\n\nconst ExternalToolManager: React.FC<ExternalToolManagerProps> = ({\n  toolCalls,\n  onToolComplete,\n  onCancel\n}) => {\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [toasts, setToasts] = useState<ToastState[]>([]);\n  const [approvalDialog, setApprovalDialog] = useState<ApprovalDialogState | null>(null);\n  const [processingResults, setProcessingResults] = useState<ToolResult[]>([]);\n\n  // Initialize builtin handlers with callbacks\n  useEffect(() => {\n    initializeBuiltinHandlers({\n      onToolComplete: (results: ToolResult[]) => {\n        setProcessingResults(prev => [...prev, ...results]);\n        onToolComplete(results);\n      },\n      onCancel: () => {\n        clearPendingToolCalls();\n        onCancel();\n      },\n      showToast: (message: string, type: 'success' | 'error' | 'warning' | 'info' = 'info') => {\n        const id = Math.random().toString(36).substr(2, 9);\n        setToasts(prev => [...prev, { id, message, type }]);\n      },\n      showApprovalDialog: (toolCalls: ToolCall[], reason?: string): Promise<boolean> => {\n        return new Promise((resolve) => {\n          setApprovalDialog({ toolCalls, reason, resolve });\n        });\n      }\n    });\n  }, [onToolComplete, onCancel]);\n\n  // Process tool calls when they are received\n  useEffect(() => {\n    if (toolCalls.length > 0 && !isProcessing) {\n      processToolCalls();\n    }\n  }, [toolCalls]);\n\n  const processToolCalls = useCallback(async () => {\n    if (toolCalls.length === 0) return;\n\n    setIsProcessing(true);\n    setProcessingResults([]);\n\n    try {\n      const handlers = createBuiltinToolHandlers();\n\n      // Create a local onToolComplete callback for this processing session\n      const localOnToolComplete = async (results: ToolResult[]) => {\n        setProcessingResults(prev => [...prev, ...results]);\n        onToolComplete(results);\n      };\n\n      await processExternalToolCalls(toolCalls, handlers, localOnToolComplete);\n      // Results will be handled by the onToolComplete callback\n    } catch (error) {\n      console.error('Error processing tool calls:', error);\n      const errorResults: ToolResult[] = toolCalls.map(toolCall => ({\n        tool_call_id: toolCall.tool_call_id,\n        result: null,\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      }));\n      setProcessingResults(errorResults);\n      onToolComplete(errorResults);\n    } finally {\n      setIsProcessing(false);\n    }\n  }, [toolCalls, onToolComplete]);\n\n  const handleApprovalDialogResponse = useCallback((approved: boolean) => {\n    if (approvalDialog) {\n      approvalDialog.resolve(approved);\n      setApprovalDialog(null);\n    }\n  }, [approvalDialog]);\n\n  const handleApprovalDialogCancel = useCallback(() => {\n    if (approvalDialog) {\n      approvalDialog.resolve(false);\n      setApprovalDialog(null);\n    }\n  }, [approvalDialog]);\n\n  const removeToast = useCallback((id: string) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id));\n  }, []);\n\n  if (toolCalls.length === 0) return null;\n\n  return (\n    <>\n      {/* Tool Processing Status */}\n      <div className=\"my-4 p-4 border border-blue-200 bg-blue-50 rounded-lg\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <div className=\"flex items-center gap-2\">\n            <Loader2 className={`w-5 h-5 text-blue-600 ${isProcessing ? 'animate-spin' : ''}`} />\n            <span className=\"font-semibold text-blue-800\">\n              {isProcessing ? 'Processing External Tools...' : 'External Tools Completed'}\n            </span>\n          </div>\n          <button\n            onClick={onCancel}\n            className=\"flex items-center gap-1 px-2 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-100 rounded transition-colors\"\n          >\n            <X className=\"w-4 h-4\" />\n            Cancel\n          </button>\n        </div>\n\n        {/* Tool Call Status */}\n        <div className=\"space-y-2\">\n          {toolCalls.map((toolCall) => {\n            const result = processingResults.find(r => r.tool_call_id === toolCall.tool_call_id);\n            const status = result ? (result.success ? 'completed' : 'error') : (isProcessing ? 'processing' : 'pending');\n\n            return (\n              <div key={toolCall.tool_call_id} className=\"flex items-center justify-between p-2 bg-white rounded border\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-medium\">{toolCall.tool_name}</span>\n                  <span className={`text-sm ${status === 'completed' ? 'text-green-600' :\n                    status === 'error' ? 'text-red-600' :\n                      status === 'processing' ? 'text-blue-600' :\n                        'text-gray-500'\n                    }`}>\n                    {status}\n                  </span>\n                </div>\n                {result && !result.success && (\n                  <span className=\"text-xs text-red-600\">{result.error}</span>\n                )}\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Results Summary */}\n        {processingResults.length > 0 && (\n          <div className=\"mt-3 p-2 bg-gray-100 rounded\">\n            <p className=\"text-sm text-gray-700\">\n              {processingResults.filter(r => r.success).length} of {processingResults.length} tools completed successfully\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* Approval Dialog */}\n      {approvalDialog && (\n        <ApprovalDialog\n          toolCalls={approvalDialog.toolCalls}\n          reason={approvalDialog.reason}\n          onApprove={() => handleApprovalDialogResponse(true)}\n          onDeny={() => handleApprovalDialogResponse(false)}\n          onCancel={handleApprovalDialogCancel}\n        />\n      )}\n\n      {/* Toasts */}\n      {toasts.map((toast) => (\n        <Toast\n          key={toast.id}\n          message={toast.message}\n          type={toast.type}\n          onClose={() => removeToast(toast.id)}\n        />\n      ))}\n    </>\n  );\n};\n\nexport default ExternalToolManager; ","import { ToolCall, ToolResult, APPROVAL_REQUEST_TOOL_NAME } from '@distri/core';\n\n// Legacy ToolHandler interface for backwards compatibility\nexport interface LegacyToolHandler {\n  (toolCall: ToolCall, onToolComplete: (toolCallId: string, result: ToolResult) => Promise<void>): Promise<{} | null>;\n}\n\n// Global state for managing tool execution\nlet pendingToolCalls: Map<string, { toolCall: ToolCall; resolve: (result: ToolResult) => void }> = new Map();\n\n// Toast management\nlet showToast: ((message: string, type?: 'success' | 'error' | 'warning' | 'info') => void) | null = null;\n\n// Approval dialog management\nlet showApprovalDialog: ((toolCalls: ToolCall[], reason?: string) => Promise<boolean>) | null = null;\n\n/**\n * Initialize the builtin handlers with callbacks\n */\nexport const initializeBuiltinHandlers = (callbacks: {\n  onToolComplete: (results: ToolResult[]) => void;\n  onCancel: () => void;\n  showToast: (message: string, type?: 'success' | 'error' | 'warning' | 'info') => void;\n  showApprovalDialog: (toolCalls: ToolCall[], reason?: string) => Promise<boolean>;\n}) => {\n  showToast = callbacks.showToast;\n  showApprovalDialog = callbacks.showApprovalDialog;\n};\n\n/**\n * Clear pending tool calls\n */\nexport const clearPendingToolCalls = () => {\n  pendingToolCalls.clear();\n};\n\n/**\n * Legacy builtin tool handlers using the old ToolHandler interface\n * These are kept for backwards compatibility but work alongside the new system\n */\nexport const createBuiltinToolHandlers = (): Record<string, LegacyToolHandler> => ({\n  // Approval request handler - opens a dialog\n  [APPROVAL_REQUEST_TOOL_NAME]: async (toolCall: ToolCall, onToolComplete: (toolCallId: string, result: ToolResult) => Promise<void>): Promise<{} | null> => {\n    try {\n      const input = typeof toolCall.input === 'string' ? JSON.parse(toolCall.input) : toolCall.input;\n      const toolCallsToApprove: ToolCall[] = input.tool_calls || [];\n      const reason: string = input.reason;\n\n      if (!showApprovalDialog) {\n        console.warn('Approval dialog not initialized');\n        return null;\n      }\n\n      const approved = await showApprovalDialog(toolCallsToApprove, reason);\n\n      // Report completion\n      const result: ToolResult = {\n        tool_call_id: toolCall.tool_call_id,\n        result: { approved, reason: approved ? 'Approved by user' : 'Denied by user' },\n        success: true\n      };\n      await onToolComplete(toolCall.tool_call_id, result);\n\n      return {\n        approved,\n        reason: approved ? 'Approved by user' : 'Denied by user',\n        tool_calls: toolCallsToApprove\n      };\n    } catch (error) {\n      console.error('Error in approval request handler:', error);\n\n      // Report error\n      const result: ToolResult = {\n        tool_call_id: toolCall.tool_call_id,\n        result: null,\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n      await onToolComplete(toolCall.tool_call_id, result);\n\n      return null;\n    }\n  },\n\n  // Toast handler - shows a toast and returns success\n  toast: async (toolCall: ToolCall, onToolComplete: (toolCallId: string, result: ToolResult) => Promise<void>): Promise<{} | null> => {\n    try {\n      const input = typeof toolCall.input === 'string' ? JSON.parse(toolCall.input) : toolCall.input;\n      const message: string = input.message || 'Toast message';\n      const type: 'success' | 'error' | 'warning' | 'info' = input.type || 'info';\n\n      if (!showToast) {\n        console.warn('Toast not initialized');\n        return null;\n      }\n\n      showToast(message, type);\n\n      // Report completion\n      const result: ToolResult = {\n        tool_call_id: toolCall.tool_call_id,\n        result: { success: true, message: 'Toast displayed successfully' },\n        success: true\n      };\n      await onToolComplete(toolCall.tool_call_id, result);\n\n      return {\n        success: true,\n        message: 'Toast displayed successfully'\n      };\n    } catch (error) {\n      console.error('Error in toast handler:', error);\n\n      // Report error\n      const result: ToolResult = {\n        tool_call_id: toolCall.tool_call_id,\n        result: null,\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n      await onToolComplete(toolCall.tool_call_id, result);\n\n      return null;\n    }\n  },\n\n  // Input request handler - shows prompt\n  input_request: async (toolCall: ToolCall, onToolComplete: (toolCallId: string, result: ToolResult) => Promise<void>): Promise<{} | null> => {\n    try {\n      const input = typeof toolCall.input === 'string' ? JSON.parse(toolCall.input) : toolCall.input;\n      const prompt: string = input.prompt || 'Please provide input:';\n      const defaultValue: string = input.default || '';\n\n      const userInput = window.prompt(prompt, defaultValue);\n\n      if (userInput === null) {\n        // Report cancellation\n        const result: ToolResult = {\n          tool_call_id: toolCall.tool_call_id,\n          result: null,\n          success: false,\n          error: 'User cancelled input'\n        };\n        await onToolComplete(toolCall.tool_call_id, result);\n        return null; // User cancelled\n      }\n\n      // Report completion\n      const result: ToolResult = {\n        tool_call_id: toolCall.tool_call_id,\n        result: { input: userInput },\n        success: true\n      };\n      await onToolComplete(toolCall.tool_call_id, result);\n\n      return {\n        input: userInput\n      };\n    } catch (error) {\n      console.error('Error in input request handler:', error);\n\n      // Report error\n      const result: ToolResult = {\n        tool_call_id: toolCall.tool_call_id,\n        result: null,\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n      await onToolComplete(toolCall.tool_call_id, result);\n\n      return null;\n    }\n  }\n});\n\n/**\n * Process external tool calls with handlers\n * This is kept for backwards compatibility\n */\nexport const processExternalToolCalls = async (\n  toolCalls: ToolCall[],\n  handlers: Record<string, LegacyToolHandler>,\n  onToolComplete: (results: ToolResult[]) => Promise<void>\n): Promise<void> => {\n  const results: ToolResult[] = [];\n\n  for (const toolCall of toolCalls) {\n    const handler = handlers[toolCall.tool_name];\n\n    if (!handler) {\n      // No handler found - report as error\n      const result: ToolResult = {\n        tool_call_id: toolCall.tool_call_id,\n        result: null,\n        success: false,\n        error: `No handler found for tool: ${toolCall.tool_name}`\n      };\n      results.push(result);\n      continue;\n    }\n\n    try {\n      // Create a wrapper onToolComplete that collects results\n      const singleToolComplete = async (_toolCallId: string, result: ToolResult) => {\n        results.push(result);\n        // Also call the main onToolComplete with all results so far\n        await onToolComplete([...results]);\n      };\n\n      // Execute handler with single tool complete callback\n      await handler(toolCall, singleToolComplete);\n    } catch (error) {\n      console.error(`Error executing tool ${toolCall.tool_name}:`, error);\n\n      // Report error\n      const result: ToolResult = {\n        tool_call_id: toolCall.tool_call_id,\n        result: null,\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n      results.push(result);\n      await onToolComplete([...results]);\n    }\n  }\n}; "],"mappings":"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","names":["error","useState","useState","useState","useEffect","useCallback","useState","useCallback","error","useEffect","useState","useEffect","useCallback","useRef","DistriClient","useState","useRef","useEffect","useCallback","metadata","useState","useEffect","useCallback","useState","useCallback","useEffect","useCallback","useRef","useState","useRef","useEffect","useCallback","useMemo","React","React","useMemo","React","createContext","useContext","jsx","jsx","React","useMemo","className","jsx","jsxs","React","textContent","jsx","jsxs","useState","useRef","scrollToBottom","useCallback","useEffect","error","useMemo","useState","useCallback","Settings","Bot","jsx","jsxs","useState","useCallback","Bot","agent","Settings","jsx","useState","CheckCircle","XCircle","jsx","jsxs","useState","useEffect","CheckCircle","XCircle","AlertTriangle","jsx","jsxs","useState","useRef","useEffect","useCallback","useMemo","Send","Loader2","Bot","Fragment","jsx","jsxs","useCallback","Send","useState","useRef","useEffect","extractTextFromMessage","shouldDisplayMessage","textContent","scrollToBottom","error","useMemo","Loader2","Bot","useState","useCallback","useEffect","X","Loader2","prompt","result","Fragment","jsx","jsxs","useState","useEffect","toolCalls","useCallback","Loader2","X"]}